!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("xmlentities")):"function"==typeof define&&define.amd?define(["xmlentities"],e):"object"==typeof exports?exports.vchatCore=e(require("xmlentities")):t.vchatCore=e(t.xmlentities)}(window,(function(t){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=36)}([function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||Function("return this")()}).call(this,n(42))},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var o=n(3);t.exports=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var o=n(2),r=n(6),i=n(19);t.exports=o?function(t,e,n){return r.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var o=n(2),r=n(23),i=n(7),a=n(22),s=Object.defineProperty;e.f=o?s:function(t,e,n){if(i(t),e=a(e,!0),i(n),r)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var o=n(4);t.exports=function(t){if(!o(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logger={log:function(){},warn:function(){},error:function(){}},e.setLogger=function(t){e.logger=t}},function(t,e,n){var o=n(0),r=n(28),i=n(1),a=n(13),s=n(32),u=n(57),c=r("wks"),l=o.Symbol,p=u?l:l&&l.withoutSetter||a;t.exports=function(t){return i(c,t)||(s&&i(l,t)?c[t]=l[t]:c[t]=p("Symbol."+t)),c[t]}},function(t,e,n){var o=n(44),r=n(21);t.exports=function(t){return o(r(t))}},function(t,e,n){var o=n(0),r=n(5);t.exports=function(t,e){try{r(o,t,e)}catch(n){o[t]=e}return e}},function(t,e,n){var o=n(28),r=n(13),i=o("keys");t.exports=function(t){return i[t]||(i[t]=r(t))}},function(t,e){var n=0,o=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++n+o).toString(36)}},function(t,e){t.exports={}},function(t,e,n){var o=n(10),r=n(52),i=n(53),a=function(t){return function(e,n,a){var s,u=o(e),c=r(u.length),l=i(a,c);if(t&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((t||l in u)&&u[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e,n){"use strict";var o,r;Object.defineProperty(e,"__esModule",{value:!0}),e.supportsWebSockets=!(!window.WebSocket||(o=navigator.userAgent.includes("Android"),r=parseInt(/WebKit\/(\d+)|$/.exec(navigator.userAgent)[1],10),o&&r<=534&&0===navigator.vendor.indexOf("Google"))),e.supportsFileReader=!!window.FileReader},function(t,e,n){var o=n(2),r=n(43),i=n(19),a=n(10),s=n(22),u=n(1),c=n(23),l=Object.getOwnPropertyDescriptor;e.f=o?l:function(t,e){if(t=a(t),e=s(e,!0),c)try{return l(t,e)}catch(t){}if(u(t,e))return i(!r.f.call(t,e),t[e])}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,n){var o=n(4);t.exports=function(t,e){if(!o(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!o(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!o(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!o(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var o=n(2),r=n(3),i=n(24);t.exports=!o&&!r((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){var o=n(0),r=n(4),i=o.document,a=r(i)&&r(i.createElement);t.exports=function(t){return a?i.createElement(t):{}}},function(t,e,n){var o=n(0),r=n(5),i=n(1),a=n(11),s=n(26),u=n(45),c=u.get,l=u.enforce,p=String(String).split("String");(t.exports=function(t,e,n,s){var u=!!s&&!!s.unsafe,c=!!s&&!!s.enumerable,f=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof e||i(n,"name")||r(n,"name",e),l(n).source=p.join("string"==typeof e?e:"")),t!==o?(u?!f&&t[e]&&(c=!0):delete t[e],c?t[e]=n:r(t,e,n)):c?t[e]=n:a(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||s(this)}))},function(t,e,n){var o=n(27),r=Function.toString;"function"!=typeof o.inspectSource&&(o.inspectSource=function(t){return r.call(t)}),t.exports=o.inspectSource},function(t,e,n){var o=n(0),r=n(11),i=o["__core-js_shared__"]||r("__core-js_shared__",{});t.exports=i},function(t,e,n){var o=n(47),r=n(27);(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.4",mode:o?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,n){var o=n(50),r=n(0),i=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?i(o[t])||i(r[t]):o[t]&&o[t][e]||r[t]&&r[t][e]}},function(t,e,n){var o=n(1),r=n(10),i=n(15).indexOf,a=n(14);t.exports=function(t,e){var n,s=r(t),u=0,c=[];for(n in s)!o(a,n)&&o(s,n)&&c.push(n);for(;e.length>u;)o(s,n=e[u++])&&(~i(c,n)||c.push(n));return c}},function(t,e){var n=Math.ceil,o=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?o:n)(t)}},function(t,e,n){var o=n(3);t.exports=!!Object.getOwnPropertySymbols&&!o((function(){return!String(Symbol())}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(82),r=/\+/g,i=/^CMDC_(\w+)/,a=/(\w+)=(\S+)/g,s=function(){function t(t,e){void 0===t&&(t=0),this.ok=!1,this.reason="",this.time=0,this.values={},this.commands=[],this.code=t,this.reason=e}return t.parse=function(e){for(var n,s=new t,u=0,c=e.split("\n");u<c.length;u++){var l=c[u];if(n=i.exec(l)){var p=n[1],f={};for(a.lastIndex=0;n=a.exec(l);){var d=n[1],h=o.decode(decodeURIComponent(n[2]));f[d]="text"!==d||"<a+href"===h.slice(0,7)||"CQUERYUSER"===p||l.includes(" from=system")?h.replace(r," "):h}switch(p){case"RESULT":s.code=parseInt(f.code,10),s.reason=f.reason,s.time=f._t?parseInt(f._t,10):0,s.ok=2e3===s.code;break;case"VALUE":for(var d in f)Object.prototype.hasOwnProperty.call(f,d)&&(s.values[d]=f[d]);break;default:s.commands.push({command:p,id:f.commandID,values:f})}}}return s},t.prototype.toString=function(){return"[ok="+this.ok+", code="+this.code+", reason="+this.reason+", time="+this.time+", values="+this.values+", commands="+this.commands+"]"},t.TIMEOUT=new t(10,"timeout"),t.NETWORK_ERROR=new t(20,"network error"),t}();e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.DEFAULT=100]="DEFAULT",t[t.USER=101]="USER",t[t.UNLOAD=103]="UNLOAD",t[t.ERROR=105]="ERROR",t[t.CLIENTDISCONNECT=107]="CLIENTDISCONNECT",t[t.TIMEOUT=108]="TIMEOUT",t[t.HOSTKICK=201]="HOSTKICK",t[t.HOST=202]="HOST",t[t.HOSTLOGOUT=203]="HOSTLOGOUT",t[t.HOSTRELOGIN=204]="HOSTRELOGIN",t[t.HOSTSENDFAIL=205]="HOSTSENDFAIL",t[t.HOSTDEVICEFAIL=206]="HOSTDEVICEFAIL",t[t.HOSTSTILLPICTURE=207]="HOSTSTILLPICTURE",t[t.HOSTCPUOVERLOAD=208]="HOSTCPUOVERLOAD",t[t.HOSTMICRONOPEGEL=209]="HOSTMICRONOPEGEL",t[t.HOSTVIDEOFAIL=210]="HOSTVIDEOFAIL",t[t.EXPIRED=211]="EXPIRED",t[t.SERVER_ADMIN_OFF=212]="SERVER_ADMIN_OFF",t[t.HOSTSENDRESTART=213]="HOSTSENDRESTART",t[t.ADMINKICK=301]="ADMINKICK",t[t.PREVIEW_LIMIT_HOST=401]="PREVIEW_LIMIT_HOST",t[t.PREVIEW_LIMIT_HOUR=402]="PREVIEW_LIMIT_HOUR",t[t.PREVIEW_OFFLINE=403]="PREVIEW_OFFLINE",t[t.PREVIEW_SINGLE=404]="PREVIEW_SINGLE",t[t.PREVIEW_FSK_DENIED=405]="PREVIEW_FSK_DENIED",t[t.PREVIEW_ACCESS_DENIE=406]="PREVIEW_ACCESS_DENIE",t[t.PREVIEW_DISABLED=407]="PREVIEW_DISABLED",t[t.VIDEOTIMELIMIT=501]="VIDEOTIMELIMIT",t[t.TEXTTIMELIMIT=502]="TEXTTIMELIMIT",t[t.FREETIMELIMIT=503]="FREETIMELIMIT",t[t.FSKDENIED=601]="FSKDENIED",t[t.AVSCONVERSION=602]="AVSCONVERSION",t[t.PREPAID_TIMEOUT=901]="PREPAID_TIMEOUT",t[t.CLIENTNEWCHAT=902]="CLIENTNEWCHAT",t[t.VOICECALLHANGUP=903]="VOICECALLHANGUP",t[t.VOICECALLNEWCHAT=904]="VOICECALLNEWCHAT",t[t.GWKILL=905]="GWKILL",t[t.HOSTSINGLE=906]="HOSTSINGLE",t[t.VIDEOFAILHOST=907]="VIDEOFAILHOST",t[t.VIDEOFAILGUEST=910]="VIDEOFAILGUEST",t[t.CLIENTLOCK=920]="CLIENTLOCK",t[t.HOSTLOCK=921]="HOSTLOCK",t[t.TIMEOUTNOOP=990]="TIMEOUTNOOP",t[t.PARTNERKICK=991]="PARTNERKICK",t[t.PHPGENERAL=995]="PHPGENERAL",t[t.VIDEOTIMEOUTHOST=996]="VIDEOTIMEOUTHOST",t[t.VIDEOTIMEOUTGUEST=997]="VIDEOTIMEOUTGUEST",t[t.SERVERDOWN=999]="SERVERDOWN"}(e.ExitCode||(e.ExitCode={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VERSION="5.1.161"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(37);var o=n(80);e.Chat=o.Chat;var r=n(34);e.ExitCode=r.ExitCode;var i=n(85);e.LogCollector=i.LogCollector;var a=n(8);e.logger=a.logger,e.setLogger=a.setLogger;var s=n(86);e.PicStream=s.PicStream;var u=n(87);e.PicUpStream=u.PicUpStream;var c=n(35);e.VERSION=c.VERSION},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(38),n(77),n(78),n(79)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(39),n(66)},function(t,e,n){n(40);var o=n(63);t.exports=o("Array","includes")},function(t,e,n){"use strict";var o=n(41),r=n(15).includes,i=n(56);o({target:"Array",proto:!0,forced:!n(62)("indexOf",{ACCESSORS:!0,1:0})},{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i("includes")},function(t,e,n){var o=n(0),r=n(18).f,i=n(5),a=n(25),s=n(11),u=n(48),c=n(55);t.exports=function(t,e){var n,l,p,f,d,h=t.target,m=t.global,v=t.stat;if(n=m?o:v?o[h]||s(h,{}):(o[h]||{}).prototype)for(l in e){if(f=e[l],p=t.noTargetGet?(d=r(n,l))&&d.value:n[l],!c(m?l:h+(v?".":"#")+l,t.forced)&&void 0!==p){if(typeof f==typeof p)continue;u(f,p)}(t.sham||p&&p.sham)&&i(f,"sham",!0),a(n,l,f,t)}}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";var o={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!o.call({1:2},1);e.f=i?function(t){var e=r(this,t);return!!e&&e.enumerable}:o},function(t,e,n){var o=n(3),r=n(20),i="".split;t.exports=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==r(t)?i.call(t,""):Object(t)}:Object},function(t,e,n){var o,r,i,a=n(46),s=n(0),u=n(4),c=n(5),l=n(1),p=n(12),f=n(14),d=s.WeakMap;if(a){var h=new d,m=h.get,v=h.has,y=h.set;o=function(t,e){return y.call(h,t,e),e},r=function(t){return m.call(h,t)||{}},i=function(t){return v.call(h,t)}}else{var g=p("state");f[g]=!0,o=function(t,e){return c(t,g,e),e},r=function(t){return l(t,g)?t[g]:{}},i=function(t){return l(t,g)}}t.exports={set:o,get:r,has:i,enforce:function(t){return i(t)?r(t):o(t,{})},getterFor:function(t){return function(e){var n;if(!u(e)||(n=r(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}}},function(t,e,n){var o=n(0),r=n(26),i=o.WeakMap;t.exports="function"==typeof i&&/native code/.test(r(i))},function(t,e){t.exports=!1},function(t,e,n){var o=n(1),r=n(49),i=n(18),a=n(6);t.exports=function(t,e){for(var n=r(e),s=a.f,u=i.f,c=0;c<n.length;c++){var l=n[c];o(t,l)||s(t,l,u(e,l))}}},function(t,e,n){var o=n(29),r=n(51),i=n(54),a=n(7);t.exports=o("Reflect","ownKeys")||function(t){var e=r.f(a(t)),n=i.f;return n?e.concat(n(t)):e}},function(t,e,n){var o=n(0);t.exports=o},function(t,e,n){var o=n(30),r=n(16).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return o(t,r)}},function(t,e,n){var o=n(31),r=Math.min;t.exports=function(t){return t>0?r(o(t),9007199254740991):0}},function(t,e,n){var o=n(31),r=Math.max,i=Math.min;t.exports=function(t,e){var n=o(t);return n<0?r(n+e,0):i(n,e)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var o=n(3),r=/#|\.prototype\./,i=function(t,e){var n=s[a(t)];return n==c||n!=u&&("function"==typeof e?o(e):!!e)},a=i.normalize=function(t){return String(t).replace(r,".").toLowerCase()},s=i.data={},u=i.NATIVE="N",c=i.POLYFILL="P";t.exports=i},function(t,e,n){var o=n(9),r=n(58),i=n(6),a=o("unscopables"),s=Array.prototype;null==s[a]&&i.f(s,a,{configurable:!0,value:r(null)}),t.exports=function(t){s[a][t]=!0}},function(t,e,n){var o=n(32);t.exports=o&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,n){var o,r=n(7),i=n(59),a=n(16),s=n(14),u=n(61),c=n(24),l=n(12),p=l("IE_PROTO"),f=function(){},d=function(t){return"<script>"+t+"<\/script>"},h=function(){try{o=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;h=o?function(t){t.write(d("")),t.close();var e=t.parentWindow.Object;return t=null,e}(o):((e=c("iframe")).style.display="none",u.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(d("document.F=Object")),t.close(),t.F);for(var n=a.length;n--;)delete h.prototype[a[n]];return h()};s[p]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(f.prototype=r(t),n=new f,f.prototype=null,n[p]=t):n=h(),void 0===e?n:i(n,e)}},function(t,e,n){var o=n(2),r=n(6),i=n(7),a=n(60);t.exports=o?Object.defineProperties:function(t,e){i(t);for(var n,o=a(e),s=o.length,u=0;s>u;)r.f(t,n=o[u++],e[n]);return t}},function(t,e,n){var o=n(30),r=n(16);t.exports=Object.keys||function(t){return o(t,r)}},function(t,e,n){var o=n(29);t.exports=o("document","documentElement")},function(t,e,n){var o=n(2),r=n(3),i=n(1),a=Object.defineProperty,s={},u=function(t){throw t};t.exports=function(t,e){if(i(s,t))return s[t];e||(e={});var n=[][t],c=!!i(e,"ACCESSORS")&&e.ACCESSORS,l=i(e,0)?e[0]:u,p=i(e,1)?e[1]:void 0;return s[t]=!!n&&!r((function(){if(c&&!o)return!0;var t={length:-1};c?a(t,1,{enumerable:!0,get:u}):t[1]=1,n.call(t,l,p)}))}},function(t,e,n){var o=n(0),r=n(64),i=Function.call;t.exports=function(t,e,n){return r(i,o[t].prototype[e],n)}},function(t,e,n){var o=n(65);t.exports=function(t,e,n){if(o(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,o){return t.call(e,n,o)};case 3:return function(n,o,r){return t.call(e,n,o,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},function(t,e,n){n(67)},function(t,e,n){"use strict";var o=n(68),r=n(15).includes,i=o.aTypedArray;(0,o.exportTypedArrayMethod)("includes",(function(t){return r(i(this),t,arguments.length>1?arguments[1]:void 0)}))},function(t,e,n){"use strict";var o,r=n(69),i=n(2),a=n(0),s=n(4),u=n(1),c=n(70),l=n(5),p=n(25),f=n(6).f,d=n(72),h=n(75),m=n(9),v=n(13),y=a.Int8Array,g=y&&y.prototype,O=a.Uint8ClampedArray,E=O&&O.prototype,S=y&&d(y),b=g&&d(g),T=Object.prototype,_=T.isPrototypeOf,C=m("toStringTag"),I=v("TYPED_ARRAY_TAG"),w=r&&!!h&&"Opera"!==c(a.opera),P=!1,R={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},x=function(t){return s(t)&&u(R,c(t))};for(o in R)a[o]||(w=!1);if((!w||"function"!=typeof S||S===Function.prototype)&&(S=function(){throw TypeError("Incorrect invocation")},w))for(o in R)a[o]&&h(a[o],S);if((!w||!b||b===T)&&(b=S.prototype,w))for(o in R)a[o]&&h(a[o].prototype,b);if(w&&d(E)!==b&&h(E,b),i&&!u(b,C))for(o in P=!0,f(b,C,{get:function(){return s(this)?this[I]:void 0}}),R)a[o]&&l(a[o],I,o);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:w,TYPED_ARRAY_TAG:P&&I,aTypedArray:function(t){if(x(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(h){if(_.call(S,t))return t}else for(var e in R)if(u(R,o)){var n=a[e];if(n&&(t===n||_.call(n,t)))return t}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n){if(i){if(n)for(var o in R){var r=a[o];r&&u(r.prototype,t)&&delete r.prototype[t]}b[t]&&!n||p(b,t,n?e:w&&g[t]||e)}},exportTypedArrayStaticMethod:function(t,e,n){var o,r;if(i){if(h){if(n)for(o in R)(r=a[o])&&u(r,t)&&delete r[t];if(S[t]&&!n)return;try{return p(S,t,n?e:w&&y[t]||e)}catch(t){}}for(o in R)!(r=a[o])||r[t]&&!n||p(r,t,e)}},isView:function(t){var e=c(t);return"DataView"===e||u(R,e)},isTypedArray:x,TypedArray:S,TypedArrayPrototype:b}},function(t,e){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(t,e,n){var o=n(71),r=n(20),i=n(9)("toStringTag"),a="Arguments"==r(function(){return arguments}());t.exports=o?r:function(t){var e,n,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),i))?n:a?r(e):"Object"==(o=r(e))&&"function"==typeof e.callee?"Arguments":o}},function(t,e,n){var o={};o[n(9)("toStringTag")]="z",t.exports="[object z]"===String(o)},function(t,e,n){var o=n(1),r=n(73),i=n(12),a=n(74),s=i("IE_PROTO"),u=Object.prototype;t.exports=a?Object.getPrototypeOf:function(t){return t=r(t),o(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,e,n){var o=n(21);t.exports=function(t){return Object(o(t))}},function(t,e,n){var o=n(3);t.exports=!o((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,e,n){var o=n(7),r=n(76);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,i){return o(n),r(i),e?t.call(n,i):n.__proto__=i,n}}():void 0)},function(t,e,n){var o=n(4);t.exports=function(t){if(!o(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},function(t,e){[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(t){Object.prototype.hasOwnProperty.call(t,"append")||Object.defineProperty(t,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Array.prototype.slice.call(t),o=document.createDocumentFragment();n.forEach((function(t){var e=t instanceof Node;o.appendChild(e?t:document.createTextNode(String(t)))})),this.appendChild(o)}})}))},function(t,e){[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(t){Object.prototype.hasOwnProperty.call(t,"remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})}))},function(t,e){[HTMLCanvasElement.prototype].forEach((function(t){Object.prototype.hasOwnProperty.call(t,"toBlob")||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var o=this;setTimeout((function(){for(var r=atob(o.toDataURL(e,n).split(",")[1]),i=r.length,a=new Uint8Array(i),s=0;s<i;s++)a[s]=r.charCodeAt(s);t(new Blob([a],{type:e||"image/png"}))}))}})}))},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((o=o.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(81),a=n(34),s=n(83),u=n(8),c=n(33),l=n(84),p=n(35),f="https://vchat.farm1.campoints.net/proxy/",d=/(ds[^.]*\.farm1\.campoints\.net).+?dataID=(\d+)/;function h(){return Promise.reject({code:4e3,reason:"not available"})}function m(t,e,n){void 0===n&&(n=!0),u.logger.log("sendTelemetry.sendTelemetry",t,e);var o=f+"clientinfo.php?type="+t;if(e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(o+="&"+r+"="+encodeURIComponent(e[r]));if("unload"===t&&"function"==typeof navigator.sendBeacon)navigator.sendBeacon(o);else{var i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");i&&(i.open("GET",o,n),i.send(null))}}function v(t,e){var n=e||[];return(t||["jpeg","mjpeg","hls","hds","rtmp","ogg","mp3","vorbis","webrtc"]).filter((function(t){return!n.includes(t)}))}e.getProtocols=v;var y=function(){function t(t,e){var n=this;if(this.queue=[],this.initState=-1,this.active=!1,this.unloadHandler=function(){return n._closeUnload()},!t.clientId)throw new Error("empty clientId");if(!t.host)throw new Error("empty host");if(!t.version)throw new Error("empty version");if(t.version.length>10)throw new Error("max length of the property 'version' is 10");if(this.config=t,e)this.handler=e;else{var o=new s.Handler(this);t.pauseSupport&&(o.onChatPause=o.onChatPauseHandler);var r=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((function(t){return n[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return r[t].apply(r,e)}}))}this.connection=new i.default(t.clientId,t.host,t.controlServletURL||"https://control.farm1.campoints.net/VXControl",t.forceLongPooling)}return t.prototype.init=function(){var t=this;if(-1!==this.initState)return h();this.initState=0,m("init",{chtmnumber:this.config.clientId,UAC:navigator.appName,UAV:navigator.appVersion,UAO:navigator.platform,AG1:"dhtml",SCR:screen.width+"x"+screen.height+" "+screen.availWidth+"x"+screen.availHeight});var e=this.config.playerVersion?"/P/"+this.config.playerVersion:"",n="C/"+p.VERSION+e+"/"+this.config.version,o=this.config.messengerProperties?JSON.stringify(this.config.messengerProperties):null;return this._sendCommand("CMDP_CINIT",{version:n,initData:this.config.initData,messengerProperties:o},(function(e){u.logger.log("INIT:",e.values),t.initState=1,t.active=!0;var n=e.values;t.host={name:n.hostlogin,imageSrc:f+"image.php?performer="+n.hostlogin},t.abilities={text:1==n.canText,video:1==n.canVideo,audio:1==n.hasAudio,preview:1==n.canPreview,upstream:1==n.canCam2Cam,single:1==n.canSingle,tip:1==n.canTip};var o={total:t._getLimit(n,"timelimit"),video:t._getLimit(n,"videolimit"),text:t._getLimit(n,"textlimit"),preview:t._getLimit(n,"previewlimit")},r=(n.chattype||"").toLowerCase(),i={text:"text"===r||"video"===r,video:"voyeur"===r||"video"===r,audio:("voyeur"===r||"video"===r)&&t.abilities.audio,preview:o.preview>0};return t.protocols=v(n.included?n.included.split(","):null,n.excluded?n.excluded.split(","):null),t.config.ignoreUnload||(window.addEventListener("beforeunload",t.unloadHandler),window.addEventListener("unload",t.unloadHandler)),t.audioMuted=1==n.audioMuted,t.uploadUrl=n.uploadUrl,t.uploadMediaUrl=n.uploadMediaUrl,n.emojiList&&(t.emojiList=JSON.parse(n.emojiList)),n.translations&&(t.translations=JSON.parse(n.translations)),t.connection.startNoop(t._noopCommandsHandler.bind(t)),t.queue.length>0&&(t.queue.forEach((function(t){return t()})),t.queue=[]),{intent:i,limits:o}}),(function(){t.initState=-1}))},t.prototype.close=function(t){var e=this;return void 0===t&&(t=a.ExitCode.USER),this.active?(setTimeout(this._close.bind(this,t),500),new Promise((function(n){e.connection.send("CMDP_CLOGOUT",{exitCode:t},(function(){e._close(t),n()}))}))):h()},t.prototype.startStream=function(t){var e=this;if(t||(t={}),"preview"===t.type)return this._sendCommand("CMDP_CSTARTPREVIEW",{},(function(n){var o=n.values,r=e.protocols.filter((function(t){return"mp3"!==t&&"ogg"!==t}));return l.getSourceSet(o,o,t,r)}));this.startStreamConfig=t;var n=[];return n.push(this._sendCommand("CMDP_CSTARTVIDEOPULL",{},(function(n,o,r){if("querying"!==n.values.state)return n.values;e.queryingVideoPull={resolve:o,reject:r,config:t}}))),t.noAudio||n.push(new Promise((function(t){e._sendCommand("CMDP_CSTARTAUDIOPULL",{},(function(t){return t.values})).then((function(e){return t(e)})).catch((function(){return t({})}))}))),Promise.all(n).then((function(n){return l.getSourceSet(n[0],n[1]||{},t,e.protocols)}))},t.prototype.startText=function(){return this._sendCommand("CMDP_CSTARTTEXT")},t.prototype.startUpstream=function(){return this._sendCommand("CMDP_CSTARTVIDEOPUSH",{flashclient:!0},(function(t){var e=t.values.dataURL,n=d.exec(e);return{jpeg:[{stream:e,width:parseInt(t.values.width),height:parseInt(t.values.height),fps:parseFloat(t.values.fps),quality:parseFloat(t.values.quality)/100}],rtmp:[{app:"rtmp://"+n[1]+"/vxstream",stream:n[2]}]}}))},t.prototype.stopUpstream=function(){return this._sendCommand("CMDP_CSTOPVIDEOPUSH")},t.prototype.startSingle=function(){return this.abilities.single?this._sendCommand("CMDP_CQUERY_SINGLE"):h()},t.prototype.sendImageFormData=function(t){return this.sendFormData(this.uploadUrl,t)},t.prototype.sendImageFile=function(t){var e=new FormData;return e.append(t.name,t,t.name),this.sendImageFormData(e)},t.prototype.sendFormData=function(t,e){return o(this,void 0,void 0,(function(){var n;return r(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch(t,{method:"POST",body:e})];case 1:return[4,o.sent().text()];case 2:return[2,{error:"OK"===(n=o.sent())?null:n,successfull:"OK"===n}];case 3:return[2,{successfull:!1,error:o.sent().message}];case 4:return[2]}}))}))},t.prototype.sendMediaFile=function(t,e){return o(this,void 0,void 0,(function(){var n,o,i,a,s;return r(this,(function(r){switch(r.label){case 0:(n=new FormData).append(t.name,t,t.name),o=this.uploadMediaUrl+"&action=CMDP_CUPLOADPIC&messageKey="+encodeURIComponent(e)+"&format=json&strip=true",r.label=1;case 1:return r.trys.push([1,4,,5]),[4,fetch(o,{method:"POST",body:n})];case 2:return[4,r.sent().text()];case 3:return i=r.sent(),a=JSON.parse(i),[2,{successfull:s=2e3===a.result.code,error:s?null:a.result.reason}];case 4:return[2,{successfull:!1,error:r.sent().message}];case 5:return[2]}}))}))},t.prototype.sendMessage=function(t,e){return this._sendCommand("CMDP_CMSG",{text:t,messageKey:e})},t.prototype.sendQueryResponse=function(t,e){return this._sendCommand("CMDP_CQUERYUSER",{key:t,response:e})},t.prototype.sendTip=function(t,e){return void 0===t&&(t=100),void 0===e&&(e=""),this.abilities.tip?this._sendCommand("CMDP_CTIP",{cent:t,gift:e}):h()},t.prototype.sendAudioState=function(t){return this._sendCommand("CMDP_CSTATUS",{statusCode:t?11:12,text:t?"sound_enabled":"sound_disabled"})},t.prototype.sendMetrics=function(t){Object.prototype.hasOwnProperty.call(t,"protocol")&&m("update",{chtmnumber:this.config.clientId,DP:t.protocol}),this._sendCommand("CMDP_CSTATUS",{statusCode:16,text:JSON.stringify(t)})},t.prototype.getChargeInfo=function(){return this._sendCommand("CMDP_CQUERY_CHARGE",{},(function(t){var e="true"==t.values.allowed||1==t.values.allowed,n=t.values.autoCharge||0;return{available:e,amounts:e?t.values.amounts.split(",").map((function(t){return parseInt(t,10)})):[],currency:e?t.values.currency:"",additionalCurrencies:e?JSON.parse(t.values.additionalCurrencies):[],autoCharged:n}}))},t.prototype.sendCharge=function(t){return this._sendCommand("CMDP_CCHARGE",{amount:t},null,null,(function(t){return"true"==t.values.successfully}))},t.prototype._closeUnload=function(){if(this.active)try{this.connection.send("CMDP_CLOGOUT",{exitCode:a.ExitCode.UNLOAD},(function(){}))}catch(t){}this._close(a.ExitCode.UNLOAD,!0,!1)},t.prototype._close=function(t,e,n,o){void 0===e&&(e=!0),void 0===n&&(n=!0),this.config.ignoreUnload||(window.removeEventListener("beforeunload",this.unloadHandler),window.removeEventListener("unload",this.unloadHandler)),this.active&&(this.active=!1,e&&m("unload",{chtmnumber:this.config.clientId,exitcode:t,comment:t},!1),n&&this.connection.close(),this.handler.onChatStop(t,o))},t.prototype._noopCommandsHandler=function(t){var e=this;if(t.ok)t.commands.forEach((function(t){return e._processCommand(t)}));else if(4104==t.code){u.logger.warn("response.code == 4104");var n=/exitCode=([\d-]+)/.exec(t.reason),o=n?parseInt(n[1],10):a.ExitCode.DEFAULT;this._close(o>0?o:a.ExitCode.DEFAULT,!1)}else t===c.default.TIMEOUT?this._close(a.ExitCode.TIMEOUT):u.logger.warn("response.code==",t.code)},t.prototype._processCommand=function(t){switch(u.logger.log("processCommand",t),t.command){case"CMSG":for(var e=t.values.messageKey,n={},o=0,r=["gift","tip","imgSrc","imgPixelated","audioOgg","audioMp3","audioM4a","videoPoster","videoHls","videoPosterPixelated","mediaType","mediaState","style","msgType"];o<r.length;o++){var i=r[o];t.values[i]&&(n[i]=t.values[i])}this.handler.onMessage(t.values.text,t.values.from,e,n);break;case"CEXIT":this._close(t.values.exitCode,!0,!0,t.values.exitMessage);break;case"CQUERYUSER":for(var s=[],c=0;;c++){var l="btn"+c;if(!Object.prototype.hasOwnProperty.call(t.values,l))break;s.push({name:t.values[l],value:0===c?"no":"yes",def:t.values.btndef==l})}var p={key:t.values.key,caption:t.values.caption,text:t.values.text,timeout:1e3*t.values.timeout,choices:s};Object.prototype.hasOwnProperty.call(t.values,"price")&&(p.price=parseInt(t.values.price,10)),this.handler.onQuery(p);break;case"CSTARTVIDEOPULL":if(this.queryingVideoPull){var f=this.queryingVideoPull;this.queryingVideoPull=null,f.resolve(t.values)}else this._resume(t.values,!0);break;case"CSTOPVIDEOPULL":"4107"==t.values.code?this._pause():(u.logger.warn("unexpected CSTOPVIDEOPULL"),this._close(a.ExitCode.ERROR));break;case"CSTOPPREVIEW":this.handler.onLimitUpdate("preview",0);break;case"CSTARTAUDIOPULL":t.values.dataURL?this._resume(t.values,!1):this.audioMuted&&this.handler.onAudioMuteUpdate(this.audioMuted=!1);break;case"CSTOPAUDIOPULL":"4107"==t.values.code?this._pause():this.audioMuted||this.handler.onAudioMuteUpdate(this.audioMuted=!0);break;case"CSTARTTEXT":this.textMuted&&this.handler.onTextMuteUpdate(this.textMuted=!1);break;case"CSTOPTEXT":"4107"==t.values.code?this._pause():this.textMuted||this.handler.onTextMuteUpdate(this.textMuted=!0);break;case"UPDATE":this._handleUpdate(t);break;default:u.logger.warn("unknown command")}},t.prototype._handleUpdate=function(t){var e=this;if(this.handler.onLimitUpdate&&[["timelimit_remain","total"],["videolimit_remain","video"],["textlimit_remain","text"],["videolimit","videolimit"]].forEach((function(n){if(Object.prototype.hasOwnProperty.call(t.values,n[0])){var o=1e3*parseInt(t.values[n[0]],10);isNaN(o)||e.handler.onLimitUpdate(n[1],o)}})),this.handler.onVideoLimitWarningUpdate&&Object.prototype.hasOwnProperty.call(t.values,"videolimit_rest")){var n=1e3*parseInt(t.values.videolimit_rest,10),o="1"===t.values.below_threshold;this.handler.onVideoLimitWarningUpdate(o,n)}if(Object.prototype.hasOwnProperty.call(t.values,"canSingle")){var r=1==t.values.canSingle;this.abilities.single!==r&&(this.abilities.single=r,this.handler.onAbilityUpdate("single",r))}if(Object.prototype.hasOwnProperty.call(t.values,"canText")){r=1==t.values.canText;this.abilities.text!==r&&(this.abilities.text=r,this.handler.onAbilityUpdate("text",r))}if(Object.prototype.hasOwnProperty.call(t.values,"isSingle")){var i=1==t.values.isSingle;i!==this.singleMode&&this.handler.onSingleModeUpdate(this.singleMode=i)}if(Object.prototype.hasOwnProperty.call(t.values,"audioMuted")){var a=1==t.values.audioMuted;a!==this.audioMuted&&this.handler.onAudioMuteUpdate(this.audioMuted=a)}},t.prototype._pause=function(){u.logger.log("Chat._pause"),this.paused||(this.handler.onChatPause?(this.paused=!0,this.handler.onChatPause()):this._close(a.ExitCode.DEFAULT))},t.prototype._resume=function(t,e){var n=this;if(this.paused){var o=this.pendingResume;o||(o=this.pendingResume={}),o[e?"v":"a"]=t;var r=function(){o.t&&clearTimeout(o.t),n.paused=!1,n.handler.onChatResume&&n.handler.onChatResume(l.getSourceSet(o.v,o.a||{},n.startStreamConfig,n.protocols)),n.pendingResume=null};o.v&&o.a?r():o.t=setTimeout((function(){return r()}),100)}},t.prototype._sendCommand=function(t,e,n,o,r){var i=this;return void 0===e&&(e={}),new Promise((function(a,s){var c=function(){i.connection.send(t,e,(function(t){if(!t.ok||r&&!r(t))o&&o(t),s({code:t.code,reason:t.reason});else if(n){var e=n(t,a,s);void 0!==e&&a(e)}else a()}))};1===i.initState||"CMDP_CINIT"===t?c():(u.logger.log("queueing command",t),i.queue.push(c))}))},t.prototype._getLimit=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?1e3*parseInt(t[e],10):-1},t}();e.Chat=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(17),r=n(8),i=n(33),a={CMDP_CCHARGE:2e4,CMDP_CLOGOUT:4e3,CMDP_CQUERY_CHARGE:2e4,CMDP_NOOP:3e4};function s(t){return a[t.action]||8e3}function u(){}var c=function(){function t(t,e,n,r){for(this.queue=[],this.counter=1,this.noopActive=!1,this.processedCommands=[],this.ackCommands=[],this.lastNoop=0,this.closing=!1,this.clientId=t,this.host=e,this.servletUrl=n,this.instanceId=Math.ceil(16777216*Math.random()).toString(16);this.instanceId.length<6;)this.instanceId="0"+this.instanceId;this.useWS=o.supportsWebSockets&&!r,this.useWS&&this.openSocket()}return t.prototype.send=function(t,e,n){e.clientID=this.clientId,e._uniq=this.counter++,e._iid=this.instanceId,r.logger.log("Connection.send",t,"_uniq",e._uniq);var o={action:t,params:e,callback:n,queued:!1,timeoutId:0};this.useWS?(this.queue.push(o),this.socket.readyState===WebSocket.OPEN?this.sendOverSocket(o):o.queued=!0):this.sendOverJsonp(o)},t.prototype.startNoop=function(t){this.noopActive=!0,this.commandsHandler=t,this.sendNoop("")},t.prototype.close=function(){this.closing=!0,this.noopActive=!1,this.queue.forEach((function(t){t.timeoutId&&window.clearTimeout(t.timeoutId)})),this.queue.splice(0,this.queue.length),this.socket&&this.socket.close()},t.prototype.openSocket=function(){var t,e=this,n="wss://"+this.host+"/VXControl/";r.logger.log("Connection.openSocket",n);try{t=new WebSocket(n)}catch(t){return r.logger.warn("Connection.openSocket SECURITY_ERR",t),void(this.useWS=!1)}t.onopen=function(t){r.logger.log("Connection:socket.onopen",t),e.queue.forEach((function(t){t.queued&&(t.queued=!1,e.sendOverSocket(t))}))},t.onmessage=function(t){r.logger.log("Connection:socket.onmessage",t);var n=JSON.parse(t.data);if(n.action)for(var o=n.params?n.params._uniq:-1,a=0,s=e.queue.length;a<s;a++){var u=e.queue[a];if(u.params._uniq==o){clearTimeout(u.timeoutId),e.queue.splice(a,1),u.callback(i.default.parse(n.response));break}}else{var c=i.default.parse(n.command);e.noopResponseHandler(c)}},t.onerror=function(t){r.logger.warn("Connection:socket.onerror",t),e.fallback()},t.onclose=function(t){r.logger.log("Connection:socket.onclose",t),!e.closing&&e.useWS&&e.fallback()},this.socket=t},t.prototype.fallback=function(){var t=this;this.useWS=!1,this.queue.forEach((function(e){e.queued&&(e.queued=!1,t.sendOverJsonp(e))}))},t.prototype.sendNoop=function(t){0===this.lastNoop&&(this.lastNoop=Date.now());var e={commandIDs:t};this.send("CMDP_NOOP",e,this.noopResponseHandler.bind(this))},t.prototype.noopResponseHandler=function(t){if((!t.ok||t.commands.length>0)&&r.logger.log("noopResponseHandler",t),t.ok){this.lastNoop=0,this.ackCommands=[];for(var e=t.commands.length-1;e>=0;e--){var n=t.commands[e].id;this.ackCommands.push(n),this.processedCommands.includes(n)?(r.logger.warn("remove processed command",n),t.commands.splice(e,1)):this.processedCommands.push(n)}for(;this.processedCommands.length>50;)this.processedCommands.shift()}(t.commands.length>0||!t.ok)&&(t!==i.default.TIMEOUT||Date.now()-this.lastNoop>6e4)&&this.commandsHandler(t),this.noopActive&&this.sendNoop(this.ackCommands.toString())},t.prototype.sendOverSocket=function(t){var e=this;t.timeoutId=window.setTimeout((function(){window.clearTimeout(t.timeoutId);var n=e.queue.indexOf(t);n>=0&&e.queue.splice(n,1),(e.noopActive||"CMDP_NOOP"!==t.action)&&t.callback(i.default.TIMEOUT)}),s(t)),this.socket.send(JSON.stringify({action:t.action,params:t.params}))},t.prototype.sendOverJsonp=function(t){var e=this.servletUrl+"?action="+t.action;for(var n in t.params)Object.prototype.hasOwnProperty.call(t.params,n)&&(e+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t.params[n]));!function(t,e,n,o){var r=null,i="_jsonp_"+Date.now()+"_"+Math.ceil(65536*Math.random()).toString(16),a=document.createElement("script"),s=document.querySelectorAll("head")[0],c=function(){r&&clearTimeout(r),s.removeChild(a);try{delete window[i]}catch(t){window[i]=void 0}};window[i]=function(t){c(),n(t)},a.src=t+(t.includes("?")?"&":"?")+"callback="+i,a.onerror=function(){c(),o("error")},s.append(a),r=setTimeout((function(){c(),window[i]=u,o("timeout")}),e)}(e,s(t),(function(e){t.callback(i.default.parse(e))}),(function(n){r.logger.warn("sendOverJsonp error",n,e),"timeout"==n?t.callback(i.default.TIMEOUT):t.callback(i.default.NETWORK_ERROR)}))},t}();e.default=c},function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this.et=t}return t.prototype.onChatStop=function(t,e){this.dispatch("chatStop",{exitCode:t,exitMessage:e})},t.prototype.onChatPauseHandler=function(){this.dispatch("chatPause",{})},t.prototype.onChatResume=function(t){this.dispatch("chatResume",{sourceSet:t})},t.prototype.onMessage=function(t,e,n,o){this.dispatch("message",{text:t,from:e,key:n,params:o})},t.prototype.onAbilityUpdate=function(t,e){this.dispatch("abilityUpdate",{name:t,value:e})},t.prototype.onQuery=function(t){this.dispatch("query",{query:t})},t.prototype.onSingleModeUpdate=function(t){this.dispatch("singleModeUpdate",{name:"singleMode",value:t})},t.prototype.onTextMuteUpdate=function(t){this.dispatch("textMuteUpdate",{name:"textMute",value:t})},t.prototype.onAudioMuteUpdate=function(t){this.dispatch("audioMuteUpdate",{name:"audioMute",value:t})},t.prototype.onLimitUpdate=function(t,e){this.dispatch("limitUpdate",{param:t,value:e})},t.prototype.dispatch=function(t,e){var n=new Event(t);for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);this.et.dispatchEvent(n)},t}();e.Handler=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=["jpeg","hls","rtmp","mp3","vorbis","webrtc"];e.getSourceSet=function(t,e,n,r){void 0===r&&(r=o);var i=t.dataURL,a=e.dataURL,s=n.mobile,u={};return(r.includes("jpeg")||r.includes("mjpeg"))&&function(t,e,n,o,r,i){var a=t.maxFps>0?t.maxFps:15,s="";t.width&&(s+="&width="+t.width);t.height&&(s+="&height="+t.height);t.resizeMode&&(s+="&sizemode="+t.resizeMode);e.includes("jpeg")&&function(t,e,n,o){if(t.mediaJpegUrl){var r=t.mediaJpegUrl+(e?"&format=43":"&format=15&quality=80")+n;o.jpeg=[{stream:r}]}}(n,o,s,r);e.includes("mjpeg")&&function(t,e,n,o,r){t.mjpeg=[{stream:e+(n?"&format=42":"&format=20&quality=80")+"&fps="+o+r}]}(r,i,o,a,s)}(n,r,t,s,u,i),r.includes("hls")&&function(t,e,n){var o;o=t?e.mediaHlsMobileUrl:e.mediaHlsUrl;o&&(n.hls=[{stream:o}])}(s,t,u),r.includes("rtmp")&&function(t,e){if(e.mediaRtmpUrl){var n=e.mediaRtmpUrl,o=/(.*)\/(\d+)/.exec(n);o&&(t.rtmp=[{app:o[1],stream:o[2]}])}}(u,t),r.includes("webrtc")&&function(t,e){e.mediaWebrtcUrl&&(t.webrtc=[{stream:e.mediaWebrtcUrl}])}(u,t),t.hlsURL&&r.includes("hls")&&(u.hls.unshift({stream:t.hlsURL}),u.preferredOrder=["hls","hds","rtmp","mjpeg","jpeg"],t.hdsURL||u.preferredOrder.splice(1,1)),e&&a&&function(t,e,n){t.includes("mp3")&&function(t,e){t.mp3=[{stream:e+"&format=8&f=stream.mp3"}]}(e,n);t.includes("vorbis")&&function(t,e){t.vorbis=[{stream:e+"&format=13&f=stream.ogg"}]}(e,n)}(r,u,a),u}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this.logEntries=[],this.logger=t}return t.prototype.clear=function(){this.logEntries=[]},Object.defineProperty(t.prototype,"logs",{get:function(){return this.logEntries},enumerable:!0,configurable:!0}),t.prototype.log=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.push(t.LOG,e,n)},t.prototype.warn=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.push(t.WARN,e,n)},t.prototype.error=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.push(t.ERROR,e,n)},t.prototype.exportToStr=function(e,n){void 0===e&&(e=0),void 0===n&&(n=0);for(var o="",r=this.logEntries.length,i=0===n?0:Math.max(r-n,0);i<r;i++){var a=this.logEntries[i];if(!(a.level<e)){var s=t.getLogLevelAsString(a.level);o+=t.GetLogEventDateAsString(new Date(a.time))+" "+s+" "+a.message+(a.params?" "+JSON.stringify(a.params):"")+"\n"}}return o},t.GetLogEventDateAsString=function(t){return t.toTimeString()},t.getLogLevelAsString=function(e){return e>=t.ERROR?"ERROR":e>=t.WARN?"WARN":"INFO"},t.getLogMethodByLevel=function(e,n){return n>=t.ERROR?e.error:n>=t.WARN?e.warn:e.log},t.prototype.push=function(e,n,o){if(this.logEntries.push({level:e,time:Date.now(),message:n,params:o}),this.logger){var r=t.getLogMethodByLevel(this.logger,e);if(o){var i=[n].concat(o);try{r.apply(void 0,i)}catch(t){}}else r(n)}},t.LOG=10,t.WARN=20,t.ERROR=30,t}();e.LogCollector=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(17),r=n(8),i=function(){function t(t){var e=this;this.counter=0,this.lastFrame=0,this.source="",this.pool=[],this.timer=0,this.useWS=!0,"function"==typeof t?this.handler=t:this.target=t,o.supportsFileReader&&(this.fileReader=new FileReader,this.fileReader.onload=function(t){var n=t.target.result;n.startsWith("data:image/jpeg;")||(n="data:image/jpeg;"+n.slice(Math.max(0,n.indexOf("base64,")))),e.loadFrame(n)});for(var n=0;n<5;n++)this.pool.push(this.createLoader(n))}return t.prototype.play=function(t,e){if(this.stop(),!e||e<0){var n=/fps=(\d+)/.exec(t);e=n?parseInt(n[1],10):15}this.maxFps=e,this.source=t,o.supportsWebSockets&&this.useWS?this._playWS():this._play()},t.prototype.stop=function(){this.timer&&clearInterval(this.timer),this.fallbackTimer&&clearTimeout(this.fallbackTimer),this.timer=this.fallbackTimer=0,this.socket&&this.socket.close();for(var t=0;t<5;t++)this.pool[t].img.src=""},t.prototype._playWS=function(){var t,e=this,n=this.source.replace(/https?:/,"wss:").replace(/:\d+\//,":443/");try{t=new WebSocket(n)}catch(t){return r.logger.warn("PicStream._playWS SECURITY_ERR",t),this.useWS=!1,void this._play()}t.onopen=function(){t.send(JSON.stringify({action:"CMDS_STARTVIDEOPULL",params:{fps:e.maxFps,base64:!e.fileReader}}))},t.onmessage=function(n){clearTimeout(e.fallbackTimer),t.onmessage=function(t){var n=t.data;if("string"==typeof n)e.loadFrame("data:image/jpeg;base64,"+n);else{var o=e.fileReader;!o||2!==o.readyState&&0!==o.readyState||o.readAsDataURL(n)}},t.onmessage(n)},t.onerror=function(t){r.logger.warn(t),clearTimeout(e.fallbackTimer),e.useWS=!1,e._play()},t.onclose=function(){r.logger.log("closed")},this.fallbackTimer=window.setTimeout((function(){r.logger.warn("PicStream._playWS fallbackTimer"),e.useWS=!1,t.close(),e._play()}),8e3),this.socket=t},t.prototype._play=function(){this.timer||(this.timer=window.setInterval(this.loadFrame.bind(this),1e3/this.maxFps),this.loadFrame())},t.prototype.createLoader=function(t){var e=this,n={id:t,img:null,frame:0,ready:!0},o=document.createElement("img");return o.onload=function(){n.frame>e.lastFrame&&(e.lastFrame=n.frame,e.target?e.target.src=o.src:e.handler(o)),n.ready=!0},o.onerror=function(){n.ready=!0},n.img=o,n},t.prototype.loadFrame=function(t){for(var e=0;e<5;e++){var n=this.pool[e];if(n.ready||n.frame<=this.lastFrame){n.frame=++this.counter,n.ready=!1,n.img.src=t||this.source+"&_u="+n.frame;break}}},t}();e.PicStream=i},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((o=o.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(17),a=n(8);var s=function(){function t(t){this._publishStopRequested=!1,this._provider=t}return t.prototype.publish=function(t,e){void 0===e&&(e=1),this._maxFps=Math.max(1,e),this._target=t,i.supportsWebSockets&&this._publishWS()},t.prototype.stop=function(){this._stopPublishLoop(),this._socket&&(this._socket.close(),this._socket=null)},t.prototype._stopPublishLoop=function(){0!==this._publishLoop&&(this._publishStopRequested=!0,clearTimeout(this._publishLoop),this._publishLoop=0)},t.prototype._publishWS=function(){var t=this,e=this._target.replace(/https?:/,"wss:").replace(/:\d+\//,":443/"),n=new WebSocket(e);n.onopen=function(){var e='{"action":"CMDS_STARTVIDEOPUSH","params":{"fps":'+t._maxFps+',"base64":true}}';n.send(e),t._startPublishLoop()},n.onmessage=function(){},n.onerror=function(e){a.logger.warn(e),t.stop()},n.onclose=function(e){a.logger.log("PicUpStream.socket.onclose",e),t._stopPublishLoop()},this._socket=n},t.prototype._startPublishLoop=function(){this._publishStopRequested=!1,this._publishLoopCall()},t.prototype._publishLoopCall=function(){return o(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this._provider.getSnapshot()];case 1:return(t=e.sent())&&this._send(t),this._publishStopRequested||(this._publishLoop=window.setTimeout(this._publishLoopCall.bind(this),1e3/this._maxFps)),[2]}}))}))},t.prototype._send=function(t){this._socket.OPEN&&this._socket.bufferedAmount<32768&&("string"==typeof t?this._socket.send(function(t){var e,n;if(t.includes(";base64,")){n=(a=t.split(";base64,"))[0].split(":")[1];var o=window.atob(a[1]),r=o.length;e=new Uint8Array(r);for(var i=0;i<r;++i)e[i]=o.charCodeAt(i)}else{var a;n=(a=t.split(","))[0].split(":")[1],e=a[1]}return new Blob([e],{type:n})}(t)):this._socket.send(t))},t}();e.PicUpStream=s}])}));
//# sourceMappingURL=vchat-core.js.map