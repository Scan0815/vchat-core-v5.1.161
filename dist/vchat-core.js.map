{"version":3,"sources":["webpack://vchatCore/webpack/universalModuleDefinition","webpack://vchatCore/webpack/bootstrap","webpack://vchatCore/../node_modules/core-js/internals/global.js","webpack://vchatCore/../node_modules/core-js/internals/has.js","webpack://vchatCore/../node_modules/core-js/internals/descriptors.js","webpack://vchatCore/../node_modules/core-js/internals/fails.js","webpack://vchatCore/../node_modules/core-js/internals/is-object.js","webpack://vchatCore/../node_modules/core-js/internals/create-non-enumerable-property.js","webpack://vchatCore/../node_modules/core-js/internals/object-define-property.js","webpack://vchatCore/../node_modules/core-js/internals/an-object.js","webpack://vchatCore/./src/logging/logger.ts","webpack://vchatCore/../node_modules/core-js/internals/well-known-symbol.js","webpack://vchatCore/../node_modules/core-js/internals/to-indexed-object.js","webpack://vchatCore/../node_modules/core-js/internals/set-global.js","webpack://vchatCore/../node_modules/core-js/internals/shared-key.js","webpack://vchatCore/../node_modules/core-js/internals/uid.js","webpack://vchatCore/../node_modules/core-js/internals/hidden-keys.js","webpack://vchatCore/../node_modules/core-js/internals/array-includes.js","webpack://vchatCore/../node_modules/core-js/internals/enum-bug-keys.js","webpack://vchatCore/./src/capabilities.ts","webpack://vchatCore/../node_modules/core-js/internals/object-get-own-property-descriptor.js","webpack://vchatCore/../node_modules/core-js/internals/create-property-descriptor.js","webpack://vchatCore/../node_modules/core-js/internals/classof-raw.js","webpack://vchatCore/../node_modules/core-js/internals/require-object-coercible.js","webpack://vchatCore/../node_modules/core-js/internals/to-primitive.js","webpack://vchatCore/../node_modules/core-js/internals/ie8-dom-define.js","webpack://vchatCore/../node_modules/core-js/internals/document-create-element.js","webpack://vchatCore/../node_modules/core-js/internals/redefine.js","webpack://vchatCore/../node_modules/core-js/internals/inspect-source.js","webpack://vchatCore/../node_modules/core-js/internals/shared-store.js","webpack://vchatCore/../node_modules/core-js/internals/shared.js","webpack://vchatCore/../node_modules/core-js/internals/get-built-in.js","webpack://vchatCore/../node_modules/core-js/internals/object-keys-internal.js","webpack://vchatCore/../node_modules/core-js/internals/to-integer.js","webpack://vchatCore/../node_modules/core-js/internals/native-symbol.js","webpack://vchatCore/./src/response.ts","webpack://vchatCore/./src/exit-code.ts","webpack://vchatCore/./src/version.ts","webpack://vchatCore/./src/vchat-core.ts","webpack://vchatCore/./src/polyfills/polyfills.ts","webpack://vchatCore/../node_modules/ts-polyfill/lib/es2016-array-include.js","webpack://vchatCore/../node_modules/core-js/es/array/includes.js","webpack://vchatCore/../node_modules/core-js/modules/es.array.includes.js","webpack://vchatCore/../node_modules/core-js/internals/export.js","webpack://vchatCore/../node_modules/webpack/buildin/global.js","webpack://vchatCore/../node_modules/core-js/internals/object-property-is-enumerable.js","webpack://vchatCore/../node_modules/core-js/internals/indexed-object.js","webpack://vchatCore/../node_modules/core-js/internals/internal-state.js","webpack://vchatCore/../node_modules/core-js/internals/native-weak-map.js","webpack://vchatCore/../node_modules/core-js/internals/is-pure.js","webpack://vchatCore/../node_modules/core-js/internals/copy-constructor-properties.js","webpack://vchatCore/../node_modules/core-js/internals/own-keys.js","webpack://vchatCore/../node_modules/core-js/internals/path.js","webpack://vchatCore/../node_modules/core-js/internals/object-get-own-property-names.js","webpack://vchatCore/../node_modules/core-js/internals/to-length.js","webpack://vchatCore/../node_modules/core-js/internals/to-absolute-index.js","webpack://vchatCore/../node_modules/core-js/internals/object-get-own-property-symbols.js","webpack://vchatCore/../node_modules/core-js/internals/is-forced.js","webpack://vchatCore/../node_modules/core-js/internals/add-to-unscopables.js","webpack://vchatCore/../node_modules/core-js/internals/use-symbol-as-uid.js","webpack://vchatCore/../node_modules/core-js/internals/object-create.js","webpack://vchatCore/../node_modules/core-js/internals/object-define-properties.js","webpack://vchatCore/../node_modules/core-js/internals/object-keys.js","webpack://vchatCore/../node_modules/core-js/internals/html.js","webpack://vchatCore/../node_modules/core-js/internals/array-method-uses-to-length.js","webpack://vchatCore/../node_modules/core-js/internals/entry-unbind.js","webpack://vchatCore/../node_modules/core-js/internals/function-bind-context.js","webpack://vchatCore/../node_modules/core-js/internals/a-function.js","webpack://vchatCore/../node_modules/core-js/es/typed-array/includes.js","webpack://vchatCore/../node_modules/core-js/modules/es.typed-array.includes.js","webpack://vchatCore/../node_modules/core-js/internals/array-buffer-view-core.js","webpack://vchatCore/../node_modules/core-js/internals/array-buffer-native.js","webpack://vchatCore/../node_modules/core-js/internals/classof.js","webpack://vchatCore/../node_modules/core-js/internals/to-string-tag-support.js","webpack://vchatCore/../node_modules/core-js/internals/object-get-prototype-of.js","webpack://vchatCore/../node_modules/core-js/internals/to-object.js","webpack://vchatCore/../node_modules/core-js/internals/correct-prototype-getter.js","webpack://vchatCore/../node_modules/core-js/internals/object-set-prototype-of.js","webpack://vchatCore/../node_modules/core-js/internals/a-possible-prototype.js","webpack://vchatCore/./src/polyfills/append.ts","webpack://vchatCore/./src/polyfills/remove.ts","webpack://vchatCore/./src/polyfills/to-blob.ts","webpack://vchatCore/./src/chat.ts","webpack://vchatCore/./src/connection.ts","webpack://vchatCore/external {\"commonjs\":\"xmlentities\",\"commonjs2\":\"xmlentities\",\"amd\":\"xmlentities\",\"root\":\"xmlentities\"}","webpack://vchatCore/./src/handler.ts","webpack://vchatCore/./src/sources/source-set-parser.ts","webpack://vchatCore/./src/logging/log-collector.ts","webpack://vchatCore/./src/pic-stream.ts","webpack://vchatCore/./src/pic-up-stream.ts"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__82__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","it","Math","check","globalThis","self","global","Function","fails","exec","error","DESCRIPTORS","definePropertyModule","createPropertyDescriptor","f","IE8_DOM_DEFINE","anObject","toPrimitive","nativeDefineProperty","O","P","Attributes","TypeError","isObject","String","logger","log","warn","shared","has","uid","NATIVE_SYMBOL","USE_SYMBOL_AS_UID","WellKnownSymbolsStore","createWellKnownSymbol","withoutSetter","IndexedObject","requireObjectCoercible","createNonEnumerableProperty","keys","id","postfix","random","undefined","toString","toIndexedObject","toLength","toAbsoluteIndex","createMethod","IS_INCLUDES","$this","el","fromIndex","length","index","includes","indexOf","maybeAndroid","webkitVer","supportsWebSockets","navigator","userAgent","parseInt","vendor","supportsFileReader","propertyIsEnumerableModule","nativeGetOwnPropertyDescriptor","getOwnPropertyDescriptor","bitmap","configurable","writable","slice","input","PREFERRED_STRING","fn","val","valueOf","createElement","a","document","EXISTS","setGlobal","inspectSource","InternalStateModule","getInternalState","enforceInternalState","enforce","TEMPLATE","split","options","unsafe","simple","noTargetGet","source","join","this","store","functionToString","IS_PURE","push","version","copyright","path","aFunction","variable","namespace","method","arguments","hiddenKeys","names","result","ceil","floor","argument","isNaN","getOwnPropertySymbols","plusPattern","commandPattern","valuePattern","code","reason","ok","time","values","commands","parse","responseStr","response","Response","line","cmdStr","lastIndex","decode","decodeURIComponent","replace","command","commandID","TIMEOUT","NETWORK_ERROR","ExitCode","VERSION","Chat","LogCollector","setLogger","PicStream","PicUpStream","entryUnbind","$","$includes","addToUnscopables","target","proto","forced","arrayMethodUsesToLength","ACCESSORS","1","redefine","copyConstructorProperties","isForced","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","sham","g","e","nativePropertyIsEnumerable","propertyIsEnumerable","NASHORN_BUG","V","classof","set","NATIVE_WEAK_MAP","objectHas","sharedKey","WeakMap","wmget","wmhas","wmset","metadata","STATE","getterFor","TYPE","state","type","test","ownKeys","getOwnPropertyDescriptorModule","getBuiltIn","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","concat","internalObjectKeys","getOwnPropertyNames","toInteger","min","max","integer","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","string","toLowerCase","wellKnownSymbol","UNSCOPABLES","ArrayPrototype","Array","iterator","activeXDocument","defineProperties","enumBugKeys","html","documentCreateElement","IE_PROTO","EmptyConstructor","scriptTag","content","LT","NullProtoObject","domain","ActiveXObject","iframeDocument","iframe","write","close","temp","parentWindow","NullProtoObjectViaActiveX","style","display","appendChild","src","contentWindow","open","F","Properties","objectKeys","cache","thrower","METHOD_NAME","argument0","argument1","CONSTRUCTOR","METHOD","that","b","apply","ArrayBufferViewCore","aTypedArray","exportTypedArrayMethod","searchElement","NAME","NATIVE_ARRAY_BUFFER","getPrototypeOf","setPrototypeOf","Int8Array","Int8ArrayPrototype","Uint8ClampedArray","Uint8ClampedArrayPrototype","TypedArray","TypedArrayPrototype","ObjectPrototype","isPrototypeOf","TO_STRING_TAG","TYPED_ARRAY_TAG","NATIVE_ARRAY_BUFFER_VIEWS","opera","TYPED_ARRAY_TAG_REQIRED","TypedArrayConstructorsList","Uint8Array","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","isTypedArray","aTypedArrayConstructor","C","ARRAY","TypedArrayConstructor","KEY","exportTypedArrayStaticMethod","isView","klass","ArrayBuffer","DataView","TO_STRING_TAG_SUPPORT","classofRaw","CORRECT_ARGUMENTS","tag","tryGet","callee","toObject","CORRECT_PROTOTYPE_GETTER","constructor","aPossiblePrototype","setter","CORRECT_SETTER","__proto__","Element","Document","DocumentFragment","forEach","item","argArr","args","docFrag","createDocumentFragment","argItem","isNode","Node","createTextNode","CharacterData","DocumentType","parentNode","removeChild","HTMLCanvasElement","callback","quality","setTimeout","binStr","atob","toDataURL","len","arr","charCodeAt","Blob","BASE_URL","dataUrlPattern","NOT_AVAILABLE","Promise","reject","sendTelemetry","params","async","url","encodeURIComponent","sendBeacon","ajax","XMLHttpRequest","send","getProtocols","included","excluded","exclude","filter","v","config","handler","queue","initState","active","unloadHandler","_closeUnload","clientId","Error","host","h","Handler","pauseSupport","onChatPause","onChatPauseHandler","xs","connection","controlServletURL","forceLongPooling","init","chtmnumber","UAC","appName","UAV","appVersion","UAO","platform","AG1","SCR","screen","width","height","availWidth","availHeight","playerVersion","messengerProperties","JSON","stringify","_sendCommand","initData","hostlogin","imageSrc","abilities","text","canText","video","canVideo","audio","hasAudio","preview","canPreview","upstream","canCam2Cam","single","canSingle","tip","canTip","limits","total","_getLimit","chattype","intent","protocols","ignoreUnload","addEventListener","audioMuted","uploadUrl","uploadMediaUrl","emojiList","translations","startNoop","_noopCommandsHandler","cmd","exitCode","USER","_close","resolve","startStream","protocolsWithoutAudio","getSourceSet","startStreamConfig","queryingVideoPull","noAudio","then","catch","all","startText","startUpstream","flashclient","dataUrl","dataURL","parts","jpeg","stream","fps","parseFloat","rtmp","app","stopUpstream","startSingle","sendImageFormData","sendFormData","sendImageFile","file","formData","FormData","append","fetch","body","responseText","successfull","message","sendMediaFile","messageKey","responseObj","success","sendMessage","sendQueryResponse","sendTip","amount","gift","cent","sendAudioState","enabled","statusCode","sendMetrics","metrics","DP","protocol","getChargeInfo","available","allowed","autoCharged","autoCharge","amounts","map","currency","additionalCurrencies","sendCharge","successfully","UNLOAD","telemetry","closeConnection","exitMessage","removeEventListener","exitcode","comment","onChatStop","_processCommand","searchResult","DEFAULT","onMessage","from","choices","btn","def","btndef","query","caption","timeout","price","onQuery","q","_resume","_pause","ERROR","onLimitUpdate","onAudioMuteUpdate","textMuted","onTextMuteUpdate","_handleUpdate","onVideoLimitWarningUpdate","videolimitRest","videolimit_rest","belowThreshold","below_threshold","onAbilityUpdate","isSingle","singleMode","onSingleModeUpdate","muted","paused","pr","pendingResume","process","clearTimeout","onChatResume","successFunc","failFunc","testFunc","pvalues","prop","commandTimeout","CMDP_CCHARGE","CMDP_CLOGOUT","CMDP_CQUERY_CHARGE","CMDP_NOOP","timeoutByAction","entry","action","noop","servletUrl","counter","noopActive","processedCommands","ackCommands","lastNoop","closing","instanceId","useWS","openSocket","clientID","_uniq","_iid","queued","timeoutId","socket","readyState","WebSocket","OPEN","sendOverSocket","sendOverJsonp","noopCommandsHandler","commandsHandler","sendNoop","element","splice","onopen","event","onmessage","cmdId","noopResponseHandler","onerror","errorEvent","fallback","onclose","commandIds","Date","now","commandIDs","shift","onComplete","onError","callbackFn","jsonpScript","parent","querySelectorAll","cleanup","fetchJsonp","et","dispatch","sourceSet","param","Event","dispatchEvent","defProtocols","vv","av","videoDataUrl","audioDataUrl","isMobile","mobile","vDataUrl","maxFps","resizeMode","mediaJpegUrl","jpegSource","getJpegSource","mjpeg","getMJpegSource","getJpegSources","hlsStreamUrl","mediaHlsMobileUrl","mediaHlsUrl","hls","getHlsSource","mediaRtmpUrl","rtmpUrl","getRtmpSource","mediaWebrtcUrl","webrtc","getWebRtcSource","hlsURL","unshift","preferredOrder","hdsURL","aDataUrl","mp3","getMp3Source","vorbis","getVorbisSource","getAudioSources","logEntries","clear","LOG","WARN","exportToStr","minLevel","entries","out","level","getLogLevelAsString","GetLogEventDateAsString","toTimeString","getLogMethodByLevel","lastFrame","pool","timer","fileReader","FileReader","onload","startsWith","loadFrame","createLoader","play","stop","res","_playWS","_play","clearInterval","fallbackTimer","img","wsSource","base64","ev","DATA_HEAD","fr","readAsDataURL","setInterval","loader","frame","ready","provider","_publishStopRequested","_provider","publish","targetFps","_maxFps","_target","_publishWS","_stopPublishLoop","_socket","_publishLoop","_startPublishLoop","_publishLoopCall","getSnapshot","snapshot","_send","bufferedAmount","raw","contentType","decoded","rawLength","dataUrlToBlob"],"mappings":"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","file":"vchat-core.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"xmlentities\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"xmlentities\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"vchatCore\"] = factory(require(\"xmlentities\"));\n\telse\n\t\troot[\"vchatCore\"] = factory(root[\"xmlentities\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__82__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 36);\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line no-undef\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func\n  Function('return this')();\n","var hasOwnProperty = {}.hasOwnProperty;\n\nmodule.exports = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n","var fails = require('../internals/fails');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !fails(function () {\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","module.exports = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar anObject = require('../internals/an-object');\nvar toPrimitive = require('../internals/to-primitive');\n\nvar nativeDefineProperty = Object.defineProperty;\n\n// `Object.defineProperty` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? nativeDefineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return nativeDefineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var isObject = require('../internals/is-object');\n\nmodule.exports = function (it) {\n  if (!isObject(it)) {\n    throw TypeError(String(it) + ' is not an object');\n  } return it;\n};\n","export interface Logger {\r\n    log: (message?: any, ...optionalParams: any[]) => void;\r\n    warn: (message?: any, ...optionalParams: any[]) => void;\r\n    error: (message?: any, ...optionalParams: any[]) => void;\r\n}\r\n\r\nexport let logger: Logger = {\r\n    log: () => {\r\n        /** noop */\r\n    },\r\n    warn: () => {\r\n        /** noop */\r\n    },\r\n    error: () => {\r\n        /** noop */\r\n    }\r\n};\r\n\r\nexport function setLogger(value: Logger): void {\r\n    logger = value;\r\n}\r\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar has = require('../internals/has');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!has(WellKnownSymbolsStore, name)) {\n    if (NATIVE_SYMBOL && has(Symbol, name)) WellKnownSymbolsStore[name] = Symbol[name];\n    else WellKnownSymbolsStore[name] = createWellKnownSymbol('Symbol.' + name);\n  } return WellKnownSymbolsStore[name];\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var global = require('../internals/global');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\n\nmodule.exports = function (key, value) {\n  try {\n    createNonEnumerableProperty(global, key, value);\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var id = 0;\nvar postfix = Math.random();\n\nmodule.exports = function (key) {\n  return 'Symbol(' + String(key === undefined ? '' : key) + ')_' + (++id + postfix).toString(36);\n};\n","module.exports = {};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toLength = require('../internals/to-length');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","function isAOSP(): boolean {\r\n    // http://stackoverflow.com/questions/14403766/how-to-detect-the-stock-android-browser\r\n    const maybeAndroid = navigator.userAgent.includes('Android');\r\n    const webkitVer = parseInt(\r\n        /WebKit\\/(\\d+)|$/.exec(navigator.userAgent)[1],\r\n        10\r\n    ); // undefined if not found\r\n    return (\r\n        maybeAndroid &&\r\n        webkitVer <= 534 &&\r\n        navigator.vendor.indexOf('Google') === 0\r\n    );\r\n\r\n    // /android.+samsungbrowser\\/([\\w\\.]+)/i,\r\n    // /android.+version\\/([\\w\\.]+)\\s+(?:mobile\\s?safari|safari)*/i\r\n}\r\n\r\nfunction _supportsWebSockets(): boolean {\r\n    // exclude Android Stock Browser (Android <= 4.4)\r\n    return !!window['WebSocket'] && !isAOSP();\r\n}\r\n\r\nfunction _supportsFileReader(): boolean {\r\n    return !!window['FileReader'];\r\n}\r\n\r\nexport const supportsWebSockets: boolean = _supportsWebSockets();\r\nexport const supportsFileReader: boolean = _supportsFileReader();\r\n","var DESCRIPTORS = require('../internals/descriptors');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPrimitive = require('../internals/to-primitive');\nvar has = require('../internals/has');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\nvar nativeGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? nativeGetOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPrimitive(P, true);\n  if (IE8_DOM_DEFINE) try {\n    return nativeGetOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (has(O, P)) return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O, P), O[P]);\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n","// `RequireObjectCoercible` abstract operation\n// https://tc39.github.io/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var isObject = require('../internals/is-object');\n\n// `ToPrimitive` abstract operation\n// https://tc39.github.io/ecma262/#sec-toprimitive\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function (input, PREFERRED_STRING) {\n  if (!isObject(input)) return input;\n  var fn, val;\n  if (PREFERRED_STRING && typeof (fn = input.toString) == 'function' && !isObject(val = fn.call(input))) return val;\n  if (typeof (fn = input.valueOf) == 'function' && !isObject(val = fn.call(input))) return val;\n  if (!PREFERRED_STRING && typeof (fn = input.toString) == 'function' && !isObject(val = fn.call(input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var global = require('../internals/global');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar has = require('../internals/has');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  if (typeof value == 'function') {\n    if (typeof key == 'string' && !has(value, 'name')) createNonEnumerableProperty(value, 'name', key);\n    enforceInternalState(value).source = TEMPLATE.join(typeof key == 'string' ? key : '');\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return typeof this == 'function' && getInternalState(this).source || inspectSource(this);\n});\n","var store = require('../internals/shared-store');\n\nvar functionToString = Function.toString;\n\n// this helper broken in `3.4.1-3.4.4`, so we can't use `shared` helper\nif (typeof store.inspectSource != 'function') {\n  store.inspectSource = function (it) {\n    return functionToString.call(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.6.4',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: ' 2020 Denis Pushkarev (zloirock.ru)'\n});\n","var path = require('../internals/path');\nvar global = require('../internals/global');\n\nvar aFunction = function (variable) {\n  return typeof variable == 'function' ? variable : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(path[namespace]) || aFunction(global[namespace])\n    : path[namespace] && path[namespace][method] || global[namespace] && global[namespace][method];\n};\n","var has = require('../internals/has');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !has(hiddenKeys, key) && has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~indexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToInteger` abstract operation\n// https://tc39.github.io/ecma262/#sec-tointeger\nmodule.exports = function (argument) {\n  return isNaN(argument = +argument) ? 0 : (argument > 0 ? floor : ceil)(argument);\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  // Chrome 38 Symbol has incorrect toString conversion\n  // eslint-disable-next-line no-undef\n  return !String(Symbol());\n});\n","/*\r\n * Copyright (c) 2016-2018. campoint AG.\r\n * This file is licensed under the MIT License (https://opensource.org/licenses/MIT).\r\n */\r\n\r\nimport { decode } from 'xmlentities';\r\n\r\nconst plusPattern = /\\+/g;\r\nconst commandPattern = /^CMDC_(\\w+)/;\r\nconst valuePattern = /(\\w+)=(\\S+)/g;\r\n\r\nexport default class Response {\r\n    public static readonly TIMEOUT: Response = new Response(10, 'timeout');\r\n    public static readonly NETWORK_ERROR: Response = new Response(\r\n        20,\r\n        'network error'\r\n    );\r\n\r\n    public static parse(responseStr: string): Response {\r\n        const response: Response = new Response();\r\n        let result: string[];\r\n\r\n        for (const line of responseStr.split('\\n')) {\r\n            result = commandPattern.exec(line);\r\n            if (!result) {\r\n                continue;\r\n            }\r\n\r\n            const cmdStr: string = result[1];\r\n            const values: any = {};\r\n            valuePattern.lastIndex = 0;\r\n            while ((result = valuePattern.exec(line))) {\r\n                const key: string = result[1];\r\n                const value: string = decode(decodeURIComponent(result[2]));\r\n\r\n                values[key] =\r\n                    key === 'text' &&\r\n                    value.slice(0, 7) !== '<a+href' &&\r\n                    cmdStr !== 'CQUERYUSER' &&\r\n                    !line.includes(' from=system')\r\n                        ? value\r\n                        : value.replace(plusPattern, ' ');\r\n            }\r\n            switch (cmdStr) {\r\n                case 'RESULT':\r\n                    response.code = parseInt(values['code'], 10);\r\n                    response.reason = values['reason'];\r\n                    response.time = values['_t']\r\n                        ? parseInt(values['_t'], 10)\r\n                        : 0;\r\n                    response.ok = response.code === 2000;\r\n                    break;\r\n                case 'VALUE':\r\n                    for (const key in values) {\r\n                        if (Object.prototype.hasOwnProperty.call(values, key)) {\r\n                            response.values[key] = values[key];\r\n                        }\r\n                    }\r\n                    break;\r\n                default:\r\n                    response.commands.push({\r\n                        command: cmdStr,\r\n                        id: values.commandID,\r\n                        values: values\r\n                    });\r\n            }\r\n        }\r\n\r\n        return response;\r\n    }\r\n\r\n    public ok = false;\r\n    public code: number;\r\n    public reason = '';\r\n    public time = 0;\r\n\r\n    public values: any = {};\r\n    public commands: Array<{ command: string; id: string; values: any }> = [];\r\n\r\n    constructor(code = 0, reason?: string) {\r\n        this.code = code;\r\n        this.reason = reason;\r\n    }\r\n\r\n    public toString(): string {\r\n        return (\r\n            '[ok=' +\r\n            this.ok +\r\n            ', code=' +\r\n            this.code +\r\n            ', reason=' +\r\n            this.reason +\r\n            ', time=' +\r\n            this.time +\r\n            ', values=' +\r\n            this.values +\r\n            ', commands=' +\r\n            this.commands +\r\n            ']'\r\n        );\r\n    }\r\n}\r\n","export enum ExitCode {\r\n    DEFAULT = 100,\r\n    USER = 101,\r\n    UNLOAD = 103,\r\n    ERROR = 105,\r\n    CLIENTDISCONNECT = 107,\r\n    TIMEOUT = 108,\r\n    HOSTKICK = 201,\r\n    HOST = 202,\r\n    HOSTLOGOUT = 203,\r\n    HOSTRELOGIN = 204,\r\n    HOSTSENDFAIL = 205,\r\n    HOSTDEVICEFAIL = 206,\r\n    HOSTSTILLPICTURE = 207,\r\n    HOSTCPUOVERLOAD = 208,\r\n    HOSTMICRONOPEGEL = 209,\r\n    HOSTVIDEOFAIL = 210,\r\n    EXPIRED = 211,\r\n    SERVER_ADMIN_OFF = 212,\r\n    HOSTSENDRESTART = 213,\r\n    ADMINKICK = 301,\r\n    PREVIEW_LIMIT_HOST = 401,\r\n    PREVIEW_LIMIT_HOUR = 402,\r\n    PREVIEW_OFFLINE = 403,\r\n    PREVIEW_SINGLE = 404,\r\n    PREVIEW_FSK_DENIED = 405,\r\n    PREVIEW_ACCESS_DENIE = 406,\r\n    PREVIEW_DISABLED = 407,\r\n    VIDEOTIMELIMIT = 501,\r\n    TEXTTIMELIMIT = 502,\r\n    FREETIMELIMIT = 503,\r\n    FSKDENIED = 601,\r\n    AVSCONVERSION = 602,\r\n    PREPAID_TIMEOUT = 901,\r\n    CLIENTNEWCHAT = 902,\r\n    VOICECALLHANGUP = 903,\r\n    VOICECALLNEWCHAT = 904,\r\n    GWKILL = 905,\r\n    HOSTSINGLE = 906,\r\n    VIDEOFAILHOST = 907,\r\n    VIDEOFAILGUEST = 910,\r\n    CLIENTLOCK = 920,\r\n    HOSTLOCK = 921,\r\n    TIMEOUTNOOP = 990,\r\n    PARTNERKICK = 991,\r\n    PHPGENERAL = 995,\r\n    VIDEOTIMEOUTHOST = 996,\r\n    VIDEOTIMEOUTGUEST = 997,\r\n    SERVERDOWN = 999\r\n}\r\n","export const VERSION = '__VERSION__';\r\n","/*\r\n * Copyright (c) 2016-2018. campoint AG.\r\n * This file is licensed under the MIT License (https://opensource.org/licenses/MIT).\r\n */\r\n\r\nimport './polyfills/polyfills';\r\n\r\nexport { Chat } from './chat';\r\nexport {\r\n    Abilities,\r\n    ChargeInfo,\r\n    ChatConfig,\r\n    ChatEventMap,\r\n    ChatHandler,\r\n    ChatResumeEvent,\r\n    ChatStopEvent,\r\n    Intent,\r\n    Limits,\r\n    MessageEvent,\r\n    MessageKey,\r\n    Query,\r\n    QueryEvent,\r\n    SourceMetrics,\r\n    StartStreamConfig,\r\n    ValueUpdateEvent\r\n} from './definitions';\r\nexport { RtmpSource } from './sources/rtmp-source';\r\nexport { Source } from './sources/source';\r\nexport { SourceSet } from './sources/source-set';\r\nexport { TargetSet } from './targets/target-set';\r\nexport { JpegTarget } from './targets/jpeg-target';\r\nexport { ExitCode } from './exit-code';\r\nexport { LogCollector } from './logging/log-collector';\r\nexport { LogEntry } from './logging/log-entry';\r\nexport { logger, setLogger } from './logging/logger';\r\nexport { PicStream } from './pic-stream';\r\nexport { PicUpStream } from './pic-up-stream';\r\nexport { Provider } from './provider';\r\nexport { VERSION } from './version';\r\n","import 'ts-polyfill/lib/es2016-array-include';\r\n\r\nimport './append';\r\nimport './remove';\r\nimport './to-blob';\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"core-js/es/array/includes\");\r\nrequire(\"core-js/es/typed-array/includes\");\r\n","require('../../modules/es.array.includes');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'includes');\n","'use strict';\nvar $ = require('../internals/export');\nvar $includes = require('../internals/array-includes').includes;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\n\n// `Array.prototype.includes` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.includes\n$({ target: 'Array', proto: true, forced: !USES_TO_LENGTH }, {\n  includes: function includes(el /* , fromIndex = 0 */) {\n    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('includes');\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty === typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","'use strict';\nvar nativePropertyIsEnumerable = {}.propertyIsEnumerable;\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !nativePropertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.github.io/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : nativePropertyIsEnumerable;\n","var fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar split = ''.split;\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split.call(it, '') : Object(it);\n} : Object;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar objectHas = require('../internals/has');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP) {\n  var store = new WeakMap();\n  var wmget = store.get;\n  var wmhas = store.has;\n  var wmset = store.set;\n  set = function (it, metadata) {\n    wmset.call(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget.call(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas.call(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return objectHas(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return objectHas(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","var global = require('../internals/global');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = typeof WeakMap === 'function' && /native code/.test(inspectSource(WeakMap));\n","module.exports = false;\n","var has = require('../internals/has');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!has(target, key)) defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n  }\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? keys.concat(getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertynames\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","var toInteger = require('../internals/to-integer');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.github.io/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toInteger(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var toInteger = require('../internals/to-integer');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toInteger(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","exports.f = Object.getOwnPropertySymbols;\n","var fails = require('../internals/fails');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : typeof detection == 'function' ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var wellKnownSymbol = require('../internals/well-known-symbol');\nvar create = require('../internals/object-create');\nvar definePropertyModule = require('../internals/object-define-property');\n\nvar UNSCOPABLES = wellKnownSymbol('unscopables');\nvar ArrayPrototype = Array.prototype;\n\n// Array.prototype[@@unscopables]\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\nif (ArrayPrototype[UNSCOPABLES] == undefined) {\n  definePropertyModule.f(ArrayPrototype, UNSCOPABLES, {\n    configurable: true,\n    value: create(null)\n  });\n}\n\n// add a key to Array.prototype[@@unscopables]\nmodule.exports = function (key) {\n  ArrayPrototype[UNSCOPABLES][key] = true;\n};\n","var NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  // eslint-disable-next-line no-undef\n  && !Symbol.sham\n  // eslint-disable-next-line no-undef\n  && typeof Symbol.iterator == 'symbol';\n","var anObject = require('../internals/an-object');\nvar defineProperties = require('../internals/object-define-properties');\nvar enumBugKeys = require('../internals/enum-bug-keys');\nvar hiddenKeys = require('../internals/hidden-keys');\nvar html = require('../internals/html');\nvar documentCreateElement = require('../internals/document-create-element');\nvar sharedKey = require('../internals/shared-key');\n\nvar GT = '>';\nvar LT = '<';\nvar PROTOTYPE = 'prototype';\nvar SCRIPT = 'script';\nvar IE_PROTO = sharedKey('IE_PROTO');\n\nvar EmptyConstructor = function () { /* empty */ };\n\nvar scriptTag = function (content) {\n  return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;\n};\n\n// Create object with fake `null` prototype: use ActiveX Object with cleared prototype\nvar NullProtoObjectViaActiveX = function (activeXDocument) {\n  activeXDocument.write(scriptTag(''));\n  activeXDocument.close();\n  var temp = activeXDocument.parentWindow.Object;\n  activeXDocument = null; // avoid memory leak\n  return temp;\n};\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar NullProtoObjectViaIFrame = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = documentCreateElement('iframe');\n  var JS = 'java' + SCRIPT + ':';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  html.appendChild(iframe);\n  // https://github.com/zloirock/core-js/issues/475\n  iframe.src = String(JS);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(scriptTag('document.F=Object'));\n  iframeDocument.close();\n  return iframeDocument.F;\n};\n\n// Check for document.domain and active x support\n// No need to use active x approach when document.domain is not set\n// see https://github.com/es-shims/es5-shim/issues/150\n// variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346\n// avoid IE GC bug\nvar activeXDocument;\nvar NullProtoObject = function () {\n  try {\n    /* global ActiveXObject */\n    activeXDocument = document.domain && new ActiveXObject('htmlfile');\n  } catch (error) { /* ignore */ }\n  NullProtoObject = activeXDocument ? NullProtoObjectViaActiveX(activeXDocument) : NullProtoObjectViaIFrame();\n  var length = enumBugKeys.length;\n  while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];\n  return NullProtoObject();\n};\n\nhiddenKeys[IE_PROTO] = true;\n\n// `Object.create` method\n// https://tc39.github.io/ecma262/#sec-object.create\nmodule.exports = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    EmptyConstructor[PROTOTYPE] = anObject(O);\n    result = new EmptyConstructor();\n    EmptyConstructor[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = NullProtoObject();\n  return Properties === undefined ? result : defineProperties(result, Properties);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar anObject = require('../internals/an-object');\nvar objectKeys = require('../internals/object-keys');\n\n// `Object.defineProperties` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperties\nmodule.exports = DESCRIPTORS ? Object.defineProperties : function defineProperties(O, Properties) {\n  anObject(O);\n  var keys = objectKeys(Properties);\n  var length = keys.length;\n  var index = 0;\n  var key;\n  while (length > index) definePropertyModule.f(O, key = keys[index++], Properties[key]);\n  return O;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.github.io/ecma262/#sec-object.keys\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('document', 'documentElement');\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar has = require('../internals/has');\n\nvar defineProperty = Object.defineProperty;\nvar cache = {};\n\nvar thrower = function (it) { throw it; };\n\nmodule.exports = function (METHOD_NAME, options) {\n  if (has(cache, METHOD_NAME)) return cache[METHOD_NAME];\n  if (!options) options = {};\n  var method = [][METHOD_NAME];\n  var ACCESSORS = has(options, 'ACCESSORS') ? options.ACCESSORS : false;\n  var argument0 = has(options, 0) ? options[0] : thrower;\n  var argument1 = has(options, 1) ? options[1] : undefined;\n\n  return cache[METHOD_NAME] = !!method && !fails(function () {\n    if (ACCESSORS && !DESCRIPTORS) return true;\n    var O = { length: -1 };\n\n    if (ACCESSORS) defineProperty(O, 1, { enumerable: true, get: thrower });\n    else O[1] = 1;\n\n    method.call(O, argument0, argument1);\n  });\n};\n","var global = require('../internals/global');\nvar bind = require('../internals/function-bind-context');\n\nvar call = Function.call;\n\nmodule.exports = function (CONSTRUCTOR, METHOD, length) {\n  return bind(call, global[CONSTRUCTOR].prototype[METHOD], length);\n};\n","var aFunction = require('../internals/a-function');\n\n// optional / simple context binding\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 0: return function () {\n      return fn.call(that);\n    };\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n","module.exports = function (it) {\n  if (typeof it != 'function') {\n    throw TypeError(String(it) + ' is not a function');\n  } return it;\n};\n","require('../../modules/es.typed-array.includes');\n","'use strict';\nvar ArrayBufferViewCore = require('../internals/array-buffer-view-core');\nvar $includes = require('../internals/array-includes').includes;\n\nvar aTypedArray = ArrayBufferViewCore.aTypedArray;\nvar exportTypedArrayMethod = ArrayBufferViewCore.exportTypedArrayMethod;\n\n// `%TypedArray%.prototype.includes` method\n// https://tc39.github.io/ecma262/#sec-%typedarray%.prototype.includes\nexportTypedArrayMethod('includes', function includes(searchElement /* , fromIndex */) {\n  return $includes(aTypedArray(this), searchElement, arguments.length > 1 ? arguments[1] : undefined);\n});\n","'use strict';\nvar NATIVE_ARRAY_BUFFER = require('../internals/array-buffer-native');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar has = require('../internals/has');\nvar classof = require('../internals/classof');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar defineProperty = require('../internals/object-define-property').f;\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar uid = require('../internals/uid');\n\nvar Int8Array = global.Int8Array;\nvar Int8ArrayPrototype = Int8Array && Int8Array.prototype;\nvar Uint8ClampedArray = global.Uint8ClampedArray;\nvar Uint8ClampedArrayPrototype = Uint8ClampedArray && Uint8ClampedArray.prototype;\nvar TypedArray = Int8Array && getPrototypeOf(Int8Array);\nvar TypedArrayPrototype = Int8ArrayPrototype && getPrototypeOf(Int8ArrayPrototype);\nvar ObjectPrototype = Object.prototype;\nvar isPrototypeOf = ObjectPrototype.isPrototypeOf;\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar TYPED_ARRAY_TAG = uid('TYPED_ARRAY_TAG');\n// Fixing native typed arrays in Opera Presto crashes the browser, see #595\nvar NATIVE_ARRAY_BUFFER_VIEWS = NATIVE_ARRAY_BUFFER && !!setPrototypeOf && classof(global.opera) !== 'Opera';\nvar TYPED_ARRAY_TAG_REQIRED = false;\nvar NAME;\n\nvar TypedArrayConstructorsList = {\n  Int8Array: 1,\n  Uint8Array: 1,\n  Uint8ClampedArray: 1,\n  Int16Array: 2,\n  Uint16Array: 2,\n  Int32Array: 4,\n  Uint32Array: 4,\n  Float32Array: 4,\n  Float64Array: 8\n};\n\nvar isView = function isView(it) {\n  var klass = classof(it);\n  return klass === 'DataView' || has(TypedArrayConstructorsList, klass);\n};\n\nvar isTypedArray = function (it) {\n  return isObject(it) && has(TypedArrayConstructorsList, classof(it));\n};\n\nvar aTypedArray = function (it) {\n  if (isTypedArray(it)) return it;\n  throw TypeError('Target is not a typed array');\n};\n\nvar aTypedArrayConstructor = function (C) {\n  if (setPrototypeOf) {\n    if (isPrototypeOf.call(TypedArray, C)) return C;\n  } else for (var ARRAY in TypedArrayConstructorsList) if (has(TypedArrayConstructorsList, NAME)) {\n    var TypedArrayConstructor = global[ARRAY];\n    if (TypedArrayConstructor && (C === TypedArrayConstructor || isPrototypeOf.call(TypedArrayConstructor, C))) {\n      return C;\n    }\n  } throw TypeError('Target is not a typed array constructor');\n};\n\nvar exportTypedArrayMethod = function (KEY, property, forced) {\n  if (!DESCRIPTORS) return;\n  if (forced) for (var ARRAY in TypedArrayConstructorsList) {\n    var TypedArrayConstructor = global[ARRAY];\n    if (TypedArrayConstructor && has(TypedArrayConstructor.prototype, KEY)) {\n      delete TypedArrayConstructor.prototype[KEY];\n    }\n  }\n  if (!TypedArrayPrototype[KEY] || forced) {\n    redefine(TypedArrayPrototype, KEY, forced ? property\n      : NATIVE_ARRAY_BUFFER_VIEWS && Int8ArrayPrototype[KEY] || property);\n  }\n};\n\nvar exportTypedArrayStaticMethod = function (KEY, property, forced) {\n  var ARRAY, TypedArrayConstructor;\n  if (!DESCRIPTORS) return;\n  if (setPrototypeOf) {\n    if (forced) for (ARRAY in TypedArrayConstructorsList) {\n      TypedArrayConstructor = global[ARRAY];\n      if (TypedArrayConstructor && has(TypedArrayConstructor, KEY)) {\n        delete TypedArrayConstructor[KEY];\n      }\n    }\n    if (!TypedArray[KEY] || forced) {\n      // V8 ~ Chrome 49-50 `%TypedArray%` methods are non-writable non-configurable\n      try {\n        return redefine(TypedArray, KEY, forced ? property : NATIVE_ARRAY_BUFFER_VIEWS && Int8Array[KEY] || property);\n      } catch (error) { /* empty */ }\n    } else return;\n  }\n  for (ARRAY in TypedArrayConstructorsList) {\n    TypedArrayConstructor = global[ARRAY];\n    if (TypedArrayConstructor && (!TypedArrayConstructor[KEY] || forced)) {\n      redefine(TypedArrayConstructor, KEY, property);\n    }\n  }\n};\n\nfor (NAME in TypedArrayConstructorsList) {\n  if (!global[NAME]) NATIVE_ARRAY_BUFFER_VIEWS = false;\n}\n\n// WebKit bug - typed arrays constructors prototype is Object.prototype\nif (!NATIVE_ARRAY_BUFFER_VIEWS || typeof TypedArray != 'function' || TypedArray === Function.prototype) {\n  // eslint-disable-next-line no-shadow\n  TypedArray = function TypedArray() {\n    throw TypeError('Incorrect invocation');\n  };\n  if (NATIVE_ARRAY_BUFFER_VIEWS) for (NAME in TypedArrayConstructorsList) {\n    if (global[NAME]) setPrototypeOf(global[NAME], TypedArray);\n  }\n}\n\nif (!NATIVE_ARRAY_BUFFER_VIEWS || !TypedArrayPrototype || TypedArrayPrototype === ObjectPrototype) {\n  TypedArrayPrototype = TypedArray.prototype;\n  if (NATIVE_ARRAY_BUFFER_VIEWS) for (NAME in TypedArrayConstructorsList) {\n    if (global[NAME]) setPrototypeOf(global[NAME].prototype, TypedArrayPrototype);\n  }\n}\n\n// WebKit bug - one more object in Uint8ClampedArray prototype chain\nif (NATIVE_ARRAY_BUFFER_VIEWS && getPrototypeOf(Uint8ClampedArrayPrototype) !== TypedArrayPrototype) {\n  setPrototypeOf(Uint8ClampedArrayPrototype, TypedArrayPrototype);\n}\n\nif (DESCRIPTORS && !has(TypedArrayPrototype, TO_STRING_TAG)) {\n  TYPED_ARRAY_TAG_REQIRED = true;\n  defineProperty(TypedArrayPrototype, TO_STRING_TAG, { get: function () {\n    return isObject(this) ? this[TYPED_ARRAY_TAG] : undefined;\n  } });\n  for (NAME in TypedArrayConstructorsList) if (global[NAME]) {\n    createNonEnumerableProperty(global[NAME], TYPED_ARRAY_TAG, NAME);\n  }\n}\n\nmodule.exports = {\n  NATIVE_ARRAY_BUFFER_VIEWS: NATIVE_ARRAY_BUFFER_VIEWS,\n  TYPED_ARRAY_TAG: TYPED_ARRAY_TAG_REQIRED && TYPED_ARRAY_TAG,\n  aTypedArray: aTypedArray,\n  aTypedArrayConstructor: aTypedArrayConstructor,\n  exportTypedArrayMethod: exportTypedArrayMethod,\n  exportTypedArrayStaticMethod: exportTypedArrayStaticMethod,\n  isView: isView,\n  isTypedArray: isTypedArray,\n  TypedArray: TypedArray,\n  TypedArrayPrototype: TypedArrayPrototype\n};\n","module.exports = typeof ArrayBuffer !== 'undefined' && typeof DataView !== 'undefined';\n","var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : result;\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var has = require('../internals/has');\nvar toObject = require('../internals/to-object');\nvar sharedKey = require('../internals/shared-key');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar IE_PROTO = sharedKey('IE_PROTO');\nvar ObjectPrototype = Object.prototype;\n\n// `Object.getPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.getprototypeof\nmodule.exports = CORRECT_PROTOTYPE_GETTER ? Object.getPrototypeOf : function (O) {\n  O = toObject(O);\n  if (has(O, IE_PROTO)) return O[IE_PROTO];\n  if (typeof O.constructor == 'function' && O instanceof O.constructor) {\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectPrototype : null;\n};\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `ToObject` abstract operation\n// https://tc39.github.io/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  function F() { /* empty */ }\n  F.prototype.constructor = null;\n  return Object.getPrototypeOf(new F()) !== F.prototype;\n});\n","var anObject = require('../internals/an-object');\nvar aPossiblePrototype = require('../internals/a-possible-prototype');\n\n// `Object.setPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.setprototypeof\n// Works with __proto__ only. Old v8 can't work with null proto objects.\n/* eslint-disable no-proto */\nmodule.exports = Object.setPrototypeOf || ('__proto__' in {} ? function () {\n  var CORRECT_SETTER = false;\n  var test = {};\n  var setter;\n  try {\n    setter = Object.getOwnPropertyDescriptor(Object.prototype, '__proto__').set;\n    setter.call(test, []);\n    CORRECT_SETTER = test instanceof Array;\n  } catch (error) { /* empty */ }\n  return function setPrototypeOf(O, proto) {\n    anObject(O);\n    aPossiblePrototype(proto);\n    if (CORRECT_SETTER) setter.call(O, proto);\n    else O.__proto__ = proto;\n    return O;\n  };\n}() : undefined);\n","var isObject = require('../internals/is-object');\n\nmodule.exports = function (it) {\n  if (!isObject(it) && it !== null) {\n    throw TypeError(\"Can't set \" + String(it) + ' as a prototype');\n  } return it;\n};\n","/* eslint-disable unicorn/prefer-node-append */\r\n[Element.prototype, Document.prototype, DocumentFragment.prototype].forEach(\r\n    (item) => {\r\n        if (Object.prototype.hasOwnProperty.call(item, 'append')) {\r\n            return;\r\n        }\r\n\r\n        Object.defineProperty(item, 'append', {\r\n            configurable: true,\r\n            enumerable: true,\r\n            writable: true,\r\n            value: function append(...args) {\r\n                const argArr = Array.prototype.slice.call(args),\r\n                    docFrag = document.createDocumentFragment();\r\n\r\n                argArr.forEach(function(argItem) {\r\n                    const isNode = argItem instanceof Node;\r\n                    docFrag.appendChild(\r\n                        isNode\r\n                            ? argItem\r\n                            : document.createTextNode(String(argItem))\r\n                    );\r\n                });\r\n\r\n                this.appendChild(docFrag);\r\n            }\r\n        });\r\n    }\r\n);\r\n","/* eslint-disable unicorn/prefer-node-remove */\r\n[Element.prototype, CharacterData.prototype, DocumentType.prototype].forEach(\r\n    (item) => {\r\n        if (Object.prototype.hasOwnProperty.call(item, 'remove')) {\r\n            return;\r\n        }\r\n\r\n        Object.defineProperty(item, 'remove', {\r\n            configurable: true,\r\n            enumerable: true,\r\n            writable: true,\r\n            value: function remove() {\r\n                if (this.parentNode !== null) this.parentNode.removeChild(this);\r\n            }\r\n        });\r\n    }\r\n);\r\n","[HTMLCanvasElement.prototype].forEach((item) => {\r\n    if (Object.prototype.hasOwnProperty.call(item, 'toBlob')) {\r\n        return;\r\n    }\r\n\r\n    Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\r\n        value: function(\r\n            callback: (b: Blob) => any,\r\n            type: string,\r\n            quality: number\r\n        ) {\r\n            setTimeout(() => {\r\n                const binStr = atob(\r\n                    this.toDataURL(type, quality).split(',')[1]\r\n                );\r\n                const len = binStr.length;\r\n                const arr = new Uint8Array(len);\r\n\r\n                for (let i = 0; i < len; i++) {\r\n                    arr[i] = binStr.charCodeAt(i);\r\n                }\r\n\r\n                callback(new Blob([arr], { type: type || 'image/png' }));\r\n            });\r\n        }\r\n    });\r\n});\r\n","/*\r\n * Copyright (c) 2016-2018. campoint AG.\r\n * This file is licensed under the MIT License (https://opensource.org/licenses/MIT).\r\n */\r\n\r\nimport Connection from './connection';\r\nimport {\r\n    Abilities,\r\n    ChargeInfo,\r\n    ChatConfig,\r\n    ChatEventMap,\r\n    ChatHandler,\r\n    Intent,\r\n    Limits,\r\n    Query,\r\n    SourceMetrics,\r\n    StartStreamConfig,\r\n    UploadResult\r\n} from './definitions';\r\nimport { ExitCode } from './exit-code';\r\nimport { Handler } from './handler';\r\nimport { logger } from './logging/logger';\r\nimport Response from './response';\r\nimport { SourceSet } from './sources/source-set';\r\nimport { getSourceSet } from './sources/source-set-parser';\r\nimport { TargetSet } from './targets/target-set';\r\nimport { VERSION } from './version';\r\nimport { Emoji } from './emoji';\r\nimport { Translations } from './translations';\r\n\r\nconst BASE_URL = 'https://vchat.farm1.campoints.net/proxy/';\r\nconst CONTROL_SERVLET_URL = 'https://control.farm1.campoints.net/VXControl';\r\n\r\nconst dataUrlPattern = /(ds[^.]*\\.farm1\\.campoints\\.net).+?dataID=(\\d+)/;\r\n\r\nfunction NOT_AVAILABLE(): Promise<any> {\r\n    return Promise.reject({ code: 4000, reason: 'not available' });\r\n}\r\n\r\nfunction sendTelemetry(type: string, params: any, async = true): void {\r\n    logger.log('sendTelemetry.sendTelemetry', type, params);\r\n\r\n    let url = `${BASE_URL}clientinfo.php?type=${type}`;\r\n    if (params) {\r\n        for (const key in params) {\r\n            if (Object.prototype.hasOwnProperty.call(params, key)) {\r\n                url += `&${key}=` + encodeURIComponent(params[key]);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (type === 'unload' && 'function' === typeof navigator.sendBeacon) {\r\n        navigator.sendBeacon(url);\r\n    } else {\r\n        /* eslint-disable no-undef */\r\n        const ajax = (window as any).XMLHttpRequest\r\n            ? new XMLHttpRequest()\r\n            : new ActiveXObject('Microsoft.XMLHTTP');\r\n        /* eslint-enable no-undef */\r\n        if (ajax) {\r\n            ajax.open('GET', url, async);\r\n            ajax.send(null);\r\n        }\r\n    }\r\n}\r\n\r\nexport function getProtocols(\r\n    included?: string[],\r\n    excluded?: string[]\r\n): string[] {\r\n    const include = included ? included : [\r\n        'jpeg',\r\n        'mjpeg',\r\n        'hls',\r\n        'hds',\r\n        'rtmp',\r\n        'ogg',\r\n        'mp3',\r\n        'vorbis',\r\n        'webrtc'\r\n    ];\r\n\r\n    const exclude = excluded ? excluded : [];\r\n\r\n    return include.filter((v) => !exclude.includes(v));\r\n}\r\n\r\nexport class Chat implements EventTarget {\r\n    // dummies\r\n    public addEventListener: <K extends keyof ChatEventMap>(\r\n        type: K,\r\n        listener: (this: Chat, ev: ChatEventMap[K]) => any,\r\n        useCapture?: boolean\r\n    ) => void;\r\n    public removeEventListener: (\r\n        type: string,\r\n        listener?: EventListenerOrEventListenerObject,\r\n        useCapture?: boolean\r\n    ) => void;\r\n    public dispatchEvent: (evt: Event) => boolean;\r\n\r\n    public host: {\r\n        name: string;\r\n        imageSrc: string;\r\n    };\r\n\r\n    /**\r\n     * A target URL for uploading images within the chat.\r\n     *\r\n     * @deprecated Use the sendImage function instead of uploading directly to this url. Will be removed in later versions\r\n     */\r\n    public uploadUrl: string;\r\n    public emojiList: Emoji[];\r\n    public translations: Translations;\r\n\r\n    public singleMode: boolean;\r\n    /** When set to true the sender has his or her microphone muted via the sender software. */\r\n    public audioMuted: boolean;\r\n    /** When set to true the sender has blocked the guest from writing. */\r\n    public textMuted: boolean;\r\n    public paused: boolean;\r\n\r\n    /**\r\n     * List (object) of abilities. All abilities are boolean values indicating whether or not the current stream offers a certain feature.\r\n     */\r\n    public abilities: Abilities;\r\n\r\n    private config: ChatConfig;\r\n    private handler: ChatHandler;\r\n    // The actual connection to the control servlet (streaming backend).\r\n    private connection: Connection;\r\n    private pendingResume: any;\r\n    private startStreamConfig: StartStreamConfig;\r\n    private queryingVideoPull: any;\r\n    private queue = [];\r\n    private initState = -1;\r\n    private protocols: string[];\r\n\r\n    // Set to true when the chat has been initialized successfully.\r\n    private active = false;\r\n    private uploadMediaUrl: string;\r\n\r\n    constructor(config: ChatConfig, handler?: ChatHandler) {\r\n        if (!config.clientId) {\r\n            throw new Error('empty clientId');\r\n        }\r\n        if (!config.host) {\r\n            throw new Error('empty host');\r\n        }\r\n        if (!config.version) {\r\n            throw new Error('empty version');\r\n        }\r\n        if (config.version.length > 10) {\r\n            throw new Error(\"max length of the property 'version' is 10\");\r\n        }\r\n\r\n        this.config = config;\r\n\r\n        if (handler) {\r\n            this.handler = handler;\r\n        } else {\r\n            const h = new Handler(this);\r\n            if (config.pauseSupport) {\r\n                h.onChatPause = h.onChatPauseHandler;\r\n            }\r\n            const delegate = document.createDocumentFragment();\r\n            [\r\n                'addEventListener',\r\n                'dispatchEvent',\r\n                'removeEventListener'\r\n            ].forEach((f) => (this[f] = (...xs): void => delegate[f](...xs)));\r\n        }\r\n\r\n        this.connection = new Connection(\r\n            config.clientId,\r\n            config.host,\r\n            config.controlServletURL || CONTROL_SERVLET_URL,\r\n            config.forceLongPooling\r\n        );\r\n    }\r\n\r\n    public init(): Promise<{ intent: Intent; limits: Limits }> {\r\n        if (this.initState !== -1) {\r\n            return NOT_AVAILABLE();\r\n        }\r\n        this.initState = 0;\r\n\r\n        sendTelemetry('init', {\r\n            chtmnumber: this.config.clientId,\r\n            UAC: navigator.appName,\r\n            UAV: navigator.appVersion,\r\n            UAO: navigator.platform,\r\n            AG1: 'dhtml',\r\n            SCR: `${screen.width}x${screen.height} ${screen.availWidth}x${screen.availHeight}`\r\n        });\r\n\r\n        const playerVersion = this.config.playerVersion\r\n            ? `/P/${this.config.playerVersion}`\r\n            : '';\r\n        const version = `C/${VERSION}${playerVersion}/${this.config.version}`;\r\n        const messengerProperties = this.config.messengerProperties\r\n            ? JSON.stringify(this.config.messengerProperties)\r\n            : null;\r\n\r\n        return this._sendCommand(\r\n            'CMDP_CINIT',\r\n            { version, initData: this.config.initData, messengerProperties },\r\n            (response) => {\r\n                logger.log('INIT:', response.values);\r\n\r\n                this.initState = 1;\r\n                this.active = true;\r\n\r\n                const values = response.values;\r\n\r\n                this.host = {\r\n                    name: values.hostlogin,\r\n                    imageSrc: `${BASE_URL}image.php?performer=${values.hostlogin}`\r\n                };\r\n\r\n                this.abilities = {\r\n                    text: values.canText == 1,\r\n                    video: values.canVideo == 1,\r\n                    audio: values.hasAudio == 1,\r\n                    preview: values.canPreview == 1,\r\n                    upstream: values.canCam2Cam == 1, // isn't set yet on chat init\r\n                    single: values.canSingle == 1,\r\n                    tip: values.canTip == 1\r\n                };\r\n\r\n                const limits: Limits = {\r\n                    total: this._getLimit(values, 'timelimit'),\r\n                    video: this._getLimit(values, 'videolimit'),\r\n                    text: this._getLimit(values, 'textlimit'),\r\n                    preview: this._getLimit(values, 'previewlimit')\r\n                };\r\n\r\n                const t: string = (values.chattype || '').toLowerCase();\r\n                const intent = {\r\n                    text: t === 'text' || t === 'video',\r\n                    video: t === 'voyeur' || t === 'video',\r\n                    audio:\r\n                        (t === 'voyeur' || t === 'video') &&\r\n                        this.abilities.audio,\r\n                    preview: limits.preview > 0\r\n                };\r\n\r\n                this.protocols = getProtocols(\r\n                    (values.included) ? values.included.split(',') : null,\r\n                    (values.excluded) ? values.excluded.split(',') : null\r\n                );\r\n\r\n                if (!this.config.ignoreUnload) {\r\n                    window.addEventListener('beforeunload', this.unloadHandler);\r\n                    window.addEventListener('unload', this.unloadHandler);\r\n                }\r\n\r\n                this.audioMuted = values.audioMuted == 1;\r\n                this.uploadUrl = values.uploadUrl;\r\n                this.uploadMediaUrl = values.uploadMediaUrl;\r\n\r\n                if (values.emojiList) {\r\n                    this.emojiList = JSON.parse(values.emojiList);\r\n                }\r\n                if (values.translations) {\r\n                    this.translations = JSON.parse(values.translations);\r\n                }\r\n\r\n                this.connection.startNoop(this._noopCommandsHandler.bind(this));\r\n                if (this.queue.length > 0) {\r\n                    this.queue.forEach((cmd) => cmd());\r\n                    this.queue = [];\r\n                }\r\n                return { intent: intent, limits: limits };\r\n            },\r\n            (): void => {\r\n                this.initState = -1;\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Ends the chat with the given exitCode and closes the websocket connection, tears down the whole chat setup.\r\n     * @param exitCode - the exitCode send to the server as the close reason\r\n     */\r\n    public close(exitCode: number = ExitCode.USER): Promise<any> {\r\n        if (!this.active) {\r\n            return NOT_AVAILABLE();\r\n        }\r\n\r\n        setTimeout(this._close.bind(this, exitCode), 500);\r\n\r\n        return new Promise((resolve) => {\r\n            this.connection.send('CMDP_CLOGOUT', { exitCode: exitCode }, () => {\r\n                this._close(exitCode);\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * This starts the actual stream for the current chat and returns a list of sources that can be passed to a player.\r\n     * @param config\r\n     * @returns A set of sources available for the given configuration / chat.\r\n     */\r\n    public startStream(config?: StartStreamConfig): Promise<SourceSet> {\r\n        if (!config) {\r\n            config = {};\r\n        }\r\n\r\n        if (config.type === 'preview') {\r\n            return this._sendCommand('CMDP_CSTARTPREVIEW', {}, (response) => {\r\n                const values = response.values;\r\n                const protocolsWithoutAudio = this.protocols.filter(\r\n                    (value) => value !== 'mp3' && value !== 'ogg'\r\n                );\r\n                return getSourceSet(\r\n                    values,\r\n                    values,\r\n                    config,\r\n                    protocolsWithoutAudio\r\n                );\r\n            });\r\n        }\r\n\r\n        this.startStreamConfig = config;\r\n        const p = [];\r\n        p.push(\r\n            this._sendCommand(\r\n                'CMDP_CSTARTVIDEOPULL',\r\n                {},\r\n                (response, resolve, reject) => {\r\n                    if (response.values.state === 'querying') {\r\n                        this.queryingVideoPull = { resolve, reject, config };\r\n                    } else {\r\n                        return response.values;\r\n                    }\r\n                }\r\n            )\r\n        );\r\n        if (!config.noAudio) {\r\n            p.push(\r\n                new Promise((resolve) => {\r\n                    this._sendCommand(\r\n                        'CMDP_CSTARTAUDIOPULL',\r\n                        {},\r\n                        (response) => response.values\r\n                    )\r\n                        .then((values) => resolve(values))\r\n                        .catch(() => resolve({}));\r\n                })\r\n            );\r\n        }\r\n\r\n        return Promise.all(p).then((values) =>\r\n            getSourceSet(values[0], values[1] || {}, config, this.protocols)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Starts the text stream part of a chat. Text streams are part of LivePreviews and full video chats. If the text stream is not running but the video stream is, the guest is in voyeur mode.\r\n     */\r\n    public startText(): Promise<any> {\r\n        return this._sendCommand('CMDP_CSTARTTEXT');\r\n    }\r\n\r\n    /**\r\n     * Starts an upstream (cam 2 cam) part for the chat\r\n     *\r\n     * @returns a list of possible upstream targets\r\n     */\r\n    public startUpstream(): Promise<TargetSet> {\r\n        return this._sendCommand(\r\n            'CMDP_CSTARTVIDEOPUSH',\r\n            { flashclient: true },\r\n            (response) => {\r\n                const dataUrl = response.values.dataURL;\r\n                const parts = dataUrlPattern.exec(dataUrl);\r\n\r\n                return {\r\n                    jpeg: [\r\n                        {\r\n                            stream: dataUrl,\r\n                            width: parseInt(response.values.width),\r\n                            height: parseInt(response.values.height),\r\n                            fps: parseFloat(response.values.fps),\r\n                            quality: parseFloat(response.values.quality) / 100\r\n                        }\r\n                    ],\r\n                    rtmp: [\r\n                        {\r\n                            app: `rtmp://${parts[1]}/vxstream`,\r\n                            stream: parts[2]\r\n                        }\r\n                    ]\r\n                };\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Stops cam 2 cam\r\n     */\r\n    public stopUpstream(): Promise<any> {\r\n        return this._sendCommand('CMDP_CSTOPVIDEOPUSH');\r\n    }\r\n\r\n    /**\r\n     * Starts the private chat mode\r\n     */\r\n    public startSingle(): Promise<any> {\r\n        return this.abilities.single\r\n            ? this._sendCommand('CMDP_CQUERY_SINGLE')\r\n            : NOT_AVAILABLE();\r\n    }\r\n\r\n    /**\r\n     * @deprecated use sendMediaFile\r\n     */\r\n    public sendImageFormData(data: FormData): Promise<UploadResult> {\r\n        return this.sendFormData(this.uploadUrl, data);\r\n    }\r\n    0;\r\n    /**\r\n     * @deprecated use sendMediaFile\r\n     */\r\n    public sendImageFile(file: File): Promise<UploadResult> {\r\n        const formData = new FormData();\r\n        formData.append(file.name, file, file.name);\r\n        return this.sendImageFormData(formData);\r\n    }\r\n\r\n    private async sendFormData(\r\n        url: string,\r\n        data: FormData\r\n    ): Promise<UploadResult> {\r\n        try {\r\n            const response = await fetch(url, {\r\n                method: 'POST',\r\n                body: data\r\n            });\r\n            const responseText = await response.text();\r\n            return {\r\n                error: responseText === 'OK' ? null : responseText,\r\n                successfull: responseText === 'OK'\r\n            };\r\n        } catch (error) {\r\n            return {\r\n                successfull: false,\r\n                error: error.message\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * send media file. For blob upload use new File([blob], filename)\r\n     * @param file\r\n     * @param messageKey\r\n     * @returns UploadResult\r\n     */\r\n    public async sendMediaFile(\r\n        file: File,\r\n        messageKey: string\r\n    ): Promise<UploadResult> {\r\n        const formData = new FormData();\r\n        formData.append(file.name, file, file.name);\r\n        /* todo: change to CMDP_UPLOADMEDIA, if implemented on the server side*/\r\n        const url =\r\n            this.uploadMediaUrl +\r\n            '&action=CMDP_CUPLOADPIC' +\r\n            '&messageKey=' +\r\n            encodeURIComponent(messageKey) +\r\n            '&format=json' +\r\n            '&strip=true';\r\n        try {\r\n            const response = await fetch(url, {\r\n                method: 'POST',\r\n                body: formData\r\n            });\r\n            const responseText = await response.text();\r\n            const responseObj = JSON.parse(responseText);\r\n            const success: boolean = responseObj.result.code === 2000;\r\n            return {\r\n                successfull: success,\r\n                error: success ? null : responseObj.result.reason\r\n            };\r\n        } catch (error) {\r\n            return {\r\n                successfull: false,\r\n                error: error.message\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sends a message from the guest to the backend to be displayed in the chat window of the sender.\r\n     *\r\n     * @param text - The message send to the sender\r\n     * @param messageKey\r\n     */\r\n    public sendMessage(text: string, messageKey?: string): Promise<any> {\r\n        return this._sendCommand('CMDP_CMSG', {\r\n            text: text,\r\n            messageKey: messageKey\r\n        });\r\n    }\r\n    /**\r\n     *  Sends a response to a query (like a private chat request) where key is a string (indicating the actual query) and the value can be of any type.\r\n     * @param key\r\n     * @param response\r\n     */\r\n    public sendQueryResponse(key: string, response: any): Promise<any> {\r\n        return this._sendCommand('CMDP_CQUERYUSER', {\r\n            key: key,\r\n            response: response\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Triggers a tip with given amount (cents) on the backend. The remaining video time limit will be adjusted accordingly. The sender will be informed about the tip via a message in the chat window. The gift parameter is an optional string indicating a certain gift type (deprecated).\r\n     *\r\n     * @param amount\r\n     * @param gift - @deprecated\r\n     */\r\n    public sendTip(amount = 100, gift = ''): Promise<any> {\r\n        return this.abilities.tip\r\n            ? this._sendCommand('CMDP_CTIP', { cent: amount, gift: gift })\r\n            : NOT_AVAILABLE();\r\n    }\r\n\r\n    /**\r\n     * Sends the current audio state (muted / unmuted) to the backend to pass it on to the sender and inform him or her about whether or not the guest can actually hear them.\r\n     *\r\n     * @param enabled\r\n     */\r\n    public sendAudioState(enabled: boolean): Promise<any> {\r\n        return this._sendCommand('CMDP_CSTATUS', {\r\n            statusCode: enabled ? 11 : 12,\r\n            text: enabled ? 'sound_enabled' : 'sound_disabled'\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sends an object to the backend for logging certain information.\r\n     * @param metrics\r\n     */\r\n    public sendMetrics(metrics: SourceMetrics | any): void {\r\n        if (Object.prototype.hasOwnProperty.call(metrics, 'protocol')) {\r\n            sendTelemetry('update', {\r\n                chtmnumber: this.config.clientId,\r\n                DP: metrics.protocol\r\n            });\r\n        }\r\n\r\n        // noinspection JSIgnoredPromiseFromCall\r\n        this._sendCommand('CMDP_CSTATUS', {\r\n            statusCode: 16,\r\n            text: JSON.stringify(metrics)\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns information about the one click payment feature\r\n     */\r\n    public getChargeInfo(): Promise<ChargeInfo> {\r\n        return this._sendCommand('CMDP_CQUERY_CHARGE', {}, (response) => {\r\n            const available =\r\n                response.values.allowed == 'true' ||\r\n                response.values.allowed == 1;\r\n            const autoCharged = response.values.autoCharge || 0;\r\n            return {\r\n                available: available,\r\n                amounts: available\r\n                    ? response.values.amounts\r\n                          .split(',')\r\n                          .map((v: string) => parseInt(v, 10))\r\n                    : [],\r\n                currency: available ? response.values.currency : '',\r\n                additionalCurrencies: available\r\n                    ? JSON.parse(response.values.additionalCurrencies)\r\n                    : [],\r\n                autoCharged: autoCharged\r\n            };\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Triggers a one click payment with the given amount (cents).\r\n     *\r\n     * @param amount - The amount to charge\r\n     */\r\n    public sendCharge(amount: number): Promise<any> {\r\n        return this._sendCommand(\r\n            'CMDP_CCHARGE',\r\n            { amount: amount },\r\n            null,\r\n            null,\r\n            (response) => response.values.successfully == 'true'\r\n        );\r\n    }\r\n\r\n    private _closeUnload(): void {\r\n        if (this.active) {\r\n            try {\r\n                this.connection.send(\r\n                    'CMDP_CLOGOUT',\r\n                    { exitCode: ExitCode.UNLOAD },\r\n                    () => {\r\n                        /* noop */\r\n                    }\r\n                );\r\n            } catch (error) {\r\n                /* noop */\r\n            }\r\n        }\r\n        this._close(ExitCode.UNLOAD, true, false);\r\n    }\r\n\r\n    private _close(\r\n        exitCode: number,\r\n        telemetry = true,\r\n        closeConnection = true,\r\n        exitMessage?: string\r\n    ): void {\r\n        if (!this.config.ignoreUnload) {\r\n            window.removeEventListener('beforeunload', this.unloadHandler);\r\n            window.removeEventListener('unload', this.unloadHandler);\r\n        }\r\n\r\n        if (this.active) {\r\n            this.active = false;\r\n            if (telemetry) {\r\n                sendTelemetry(\r\n                    'unload',\r\n                    {\r\n                        chtmnumber: this.config.clientId,\r\n                        exitcode: exitCode,\r\n                        comment: exitCode\r\n                    },\r\n                    false\r\n                );\r\n            }\r\n\r\n            if (closeConnection) {\r\n                this.connection.close();\r\n            }\r\n\r\n            this.handler.onChatStop(exitCode, exitMessage);\r\n        }\r\n    }\r\n\r\n    private _noopCommandsHandler(response: Response): void {\r\n        if (response.ok) {\r\n            response.commands.forEach((command) =>\r\n                this._processCommand(command)\r\n            );\r\n        } else if (response.code == 4104) {\r\n            logger.warn('response.code == 4104');\r\n            const searchResult = /exitCode=([\\d-]+)/.exec(response.reason);\r\n            const exitCode: number = searchResult\r\n                ? parseInt(searchResult[1], 10)\r\n                : ExitCode.DEFAULT;\r\n            this._close(exitCode > 0 ? exitCode : ExitCode.DEFAULT, false);\r\n        } else if (response === Response.TIMEOUT) {\r\n            this._close(ExitCode.TIMEOUT);\r\n        } else {\r\n            logger.warn('response.code==', response.code);\r\n        }\r\n    }\r\n\r\n    private _processCommand(command: {\r\n        command: string;\r\n        id: string;\r\n        values: any;\r\n    }): void {\r\n        logger.log('processCommand', command);\r\n        switch (command.command) {\r\n            case 'CMSG': {\r\n                const messageKey = command.values.messageKey;\r\n                const paramKeys = [\r\n                    'gift',\r\n                    'tip',\r\n                    'imgSrc',\r\n                    'imgPixelated',\r\n                    'audioOgg',\r\n                    'audioMp3',\r\n                    'audioM4a',\r\n                    'videoPoster',\r\n                    'videoHls',\r\n                    'videoPosterPixelated',\r\n                    'mediaType',\r\n                    'mediaState',\r\n                    'style',\r\n                    'msgType'\r\n                ];\r\n                const params = {};\r\n\r\n                for (const key of paramKeys) {\r\n                    if (command.values[key]) {\r\n                        params[key] = command.values[key];\r\n                    }\r\n                }\r\n\r\n                this.handler.onMessage(\r\n                    command.values.text,\r\n                    command.values.from,\r\n                    messageKey,\r\n                    params\r\n                );\r\n                break;\r\n            }\r\n\r\n            case 'CEXIT': {\r\n                this._close(\r\n                    command.values.exitCode,\r\n                    true,\r\n                    true,\r\n                    command.values.exitMessage\r\n                );\r\n                break;\r\n            }\r\n            case 'CQUERYUSER': {\r\n                const choices = [];\r\n                for (let i = 0; ; i++) {\r\n                    const btn = `btn${i}`;\r\n                    if (\r\n                        !Object.prototype.hasOwnProperty.call(\r\n                            command.values,\r\n                            btn\r\n                        )\r\n                    ) {\r\n                        break;\r\n                    }\r\n                    choices.push({\r\n                        name: command.values[btn],\r\n                        value: i === 0 ? 'no' : 'yes',\r\n                        def: command.values.btndef == btn\r\n                    });\r\n                }\r\n\r\n                const query: Query = {\r\n                    // single|querysingle|...\r\n                    key: command.values.key,\r\n                    caption: command.values.caption,\r\n                    text: command.values.text,\r\n                    timeout: command.values.timeout * 1000,\r\n                    choices: choices\r\n                };\r\n                if (\r\n                    Object.prototype.hasOwnProperty.call(\r\n                        command.values,\r\n                        'price'\r\n                    )\r\n                ) {\r\n                    query.price = parseInt(command.values.price, 10);\r\n                }\r\n\r\n                this.handler.onQuery(query);\r\n                break;\r\n            }\r\n\r\n            case 'CSTARTVIDEOPULL': {\r\n                if (this.queryingVideoPull) {\r\n                    const q = this.queryingVideoPull;\r\n                    this.queryingVideoPull = null;\r\n                    q.resolve(command.values);\r\n                } else {\r\n                    this._resume(command.values, true);\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'CSTOPVIDEOPULL': {\r\n                if (command.values.code == '4107') {\r\n                    this._pause();\r\n                } else {\r\n                    logger.warn('unexpected CSTOPVIDEOPULL');\r\n                    this._close(ExitCode.ERROR);\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'CSTOPPREVIEW': {\r\n                this.handler.onLimitUpdate('preview', 0);\r\n                break;\r\n            }\r\n\r\n            case 'CSTARTAUDIOPULL': {\r\n                if (command.values.dataURL) {\r\n                    this._resume(command.values, false);\r\n                } else if (this.audioMuted) {\r\n                    this.handler.onAudioMuteUpdate((this.audioMuted = false));\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'CSTOPAUDIOPULL': {\r\n                if (command.values.code == '4107') {\r\n                    this._pause();\r\n                } else {\r\n                    if (!this.audioMuted) {\r\n                        this.handler.onAudioMuteUpdate(\r\n                            (this.audioMuted = true)\r\n                        );\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'CSTARTTEXT': {\r\n                if (this.textMuted) {\r\n                    this.handler.onTextMuteUpdate((this.textMuted = false));\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'CSTOPTEXT': {\r\n                if (command.values.code == '4107') {\r\n                    this._pause();\r\n                } else {\r\n                    if (!this.textMuted) {\r\n                        this.handler.onTextMuteUpdate((this.textMuted = true));\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'UPDATE': {\r\n                // handling limits update\r\n                this._handleUpdate(command);\r\n\r\n                break;\r\n            }\r\n            default: {\r\n                logger.warn('unknown command');\r\n            }\r\n        }\r\n    }\r\n\r\n    private _handleUpdate(command: {\r\n        command: string;\r\n        id: string;\r\n        values: any;\r\n    }): void {\r\n        if (this.handler.onLimitUpdate) {\r\n            [\r\n                ['timelimit_remain', 'total'],\r\n                ['videolimit_remain', 'video'],\r\n                ['textlimit_remain', 'text'],\r\n                ['videolimit', 'videolimit']\r\n            ].forEach((v) => {\r\n                if (\r\n                    Object.prototype.hasOwnProperty.call(command.values, v[0])\r\n                ) {\r\n                    const value = parseInt(command.values[v[0]], 10) * 1000;\r\n                    if (!isNaN(value)) {\r\n                        this.handler.onLimitUpdate(v[1] as keyof Limits, value);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (\r\n            this.handler.onVideoLimitWarningUpdate &&\r\n            Object.prototype.hasOwnProperty.call(\r\n                command.values,\r\n                'videolimit_rest'\r\n            )\r\n        ) {\r\n            const videolimitRest =\r\n                parseInt(command.values.videolimit_rest, 10) * 1000;\r\n\r\n            const belowThreshold = command.values.below_threshold === '1';\r\n\r\n            this.handler.onVideoLimitWarningUpdate(\r\n                belowThreshold,\r\n                videolimitRest\r\n            );\r\n        }\r\n\r\n        if (Object.prototype.hasOwnProperty.call(command.values, 'canSingle')) {\r\n            const value = command.values.canSingle == 1;\r\n            if (this.abilities.single !== value) {\r\n                this.abilities.single = value;\r\n                this.handler.onAbilityUpdate('single', value);\r\n            }\r\n        }\r\n        if (Object.prototype.hasOwnProperty.call(command.values, 'canText')) {\r\n            const value = command.values.canText == 1;\r\n            if (this.abilities.text !== value) {\r\n                this.abilities.text = value;\r\n                this.handler.onAbilityUpdate('text', value);\r\n            }\r\n        }\r\n        if (Object.prototype.hasOwnProperty.call(command.values, 'isSingle')) {\r\n            const single = command.values.isSingle == 1;\r\n            if (single !== this.singleMode) {\r\n                this.handler.onSingleModeUpdate((this.singleMode = single));\r\n            }\r\n        }\r\n        if (\r\n            Object.prototype.hasOwnProperty.call(command.values, 'audioMuted')\r\n        ) {\r\n            const muted = command.values.audioMuted == 1;\r\n            if (muted !== this.audioMuted) {\r\n                this.handler.onAudioMuteUpdate((this.audioMuted = muted));\r\n            }\r\n        }\r\n    }\r\n\r\n    private _pause(): void {\r\n        logger.log('Chat._pause');\r\n        if (!this.paused) {\r\n            if (this.handler.onChatPause) {\r\n                this.paused = true;\r\n\r\n                this.handler.onChatPause();\r\n            } else {\r\n                this._close(ExitCode.DEFAULT);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _resume(values: any, video: boolean): void {\r\n        if (!this.paused) {\r\n            return;\r\n        }\r\n\r\n        let pr = this.pendingResume;\r\n        if (!pr) {\r\n            pr = this.pendingResume = {};\r\n        }\r\n        pr[video ? 'v' : 'a'] = values;\r\n\r\n        const process = (): void => {\r\n            if (pr.t) {\r\n                clearTimeout(pr.t);\r\n            }\r\n            this.paused = false;\r\n            if (this.handler.onChatResume) {\r\n                this.handler.onChatResume(\r\n                    getSourceSet(\r\n                        pr.v,\r\n                        pr.a || {},\r\n                        this.startStreamConfig,\r\n                        this.protocols\r\n                    )\r\n                );\r\n            }\r\n            this.pendingResume = null;\r\n        };\r\n\r\n        if (pr.v && pr.a) {\r\n            process();\r\n        } else {\r\n            pr.t = setTimeout(() => process(), 100);\r\n        }\r\n    }\r\n\r\n    private _sendCommand(\r\n        command: string,\r\n        params: any = {},\r\n        successFunc?: (response: Response, res?, rej?) => any,\r\n        failFunc?: (Response: Response) => any,\r\n        testFunc?: (response: Response) => boolean\r\n    ): Promise<any> {\r\n        return new Promise((resolve, reject) => {\r\n            const cmd = (): void => {\r\n                this.connection.send(command, params, (response) => {\r\n                    if (response.ok && (!testFunc || testFunc(response))) {\r\n                        if (successFunc) {\r\n                            const result = successFunc(\r\n                                response,\r\n                                resolve,\r\n                                reject\r\n                            );\r\n                            if (result !== undefined) {\r\n                                resolve(result);\r\n                            }\r\n                        } else {\r\n                            resolve();\r\n                        }\r\n                    } else {\r\n                        if (failFunc) {\r\n                            failFunc(response);\r\n                        }\r\n                        reject({\r\n                            code: response.code,\r\n                            reason: response.reason\r\n                        });\r\n                    }\r\n                });\r\n            };\r\n            if (this.initState === 1 || command === 'CMDP_CINIT') {\r\n                cmd();\r\n            } else {\r\n                logger.log('queueing command', command);\r\n                this.queue.push(cmd);\r\n            }\r\n        });\r\n    }\r\n\r\n    private unloadHandler = (): void => this._closeUnload();\r\n\r\n    private _getLimit(pvalues, prop: string): number {\r\n        return Object.prototype.hasOwnProperty.call(pvalues, prop)\r\n            ? parseInt(pvalues[prop], 10) * 1000\r\n            : -1;\r\n    }\r\n}\r\n","/*\r\n * Copyright (c) 2016-2018. campoint AG.\r\n * This file is licensed under the MIT License (https://opensource.org/licenses/MIT).\r\n */\r\n\r\nimport { supportsWebSockets } from './capabilities';\r\nimport { logger } from './logging/logger';\r\nimport Response from './response';\r\n\r\ninterface QEntry {\r\n    action: string;\r\n    params: any;\r\n    callback: (response: Response) => any;\r\n    format?: string;\r\n    queued?: boolean;\r\n    timeoutId?: number;\r\n}\r\n\r\nconst MAX_TIMEOUT = 60000;\r\nconst commandTimeout = {\r\n    CMDP_CCHARGE: 20000,\r\n    CMDP_CLOGOUT: 4000,\r\n    CMDP_CQUERY_CHARGE: 20000,\r\n    CMDP_NOOP: 30000\r\n};\r\n\r\nfunction timeoutByAction(entry: QEntry): number {\r\n    return commandTimeout[entry.action] || 8000;\r\n}\r\n\r\nfunction noop(): void {\r\n    /* noop function */\r\n}\r\n\r\nfunction fetchJsonp(url: string, timeout: number, onComplete, onError): void {\r\n    let timeoutId = null;\r\n    const callbackFn =\r\n        '_jsonp_' +\r\n        Date.now() +\r\n        '_' +\r\n        Math.ceil(Math.random() * 0x10000).toString(16);\r\n    const jsonpScript = document.createElement('script');\r\n    const parent = document.querySelectorAll('head')[0];\r\n\r\n    const cleanup = (): void => {\r\n        if (timeoutId) {\r\n            clearTimeout(timeoutId);\r\n        }\r\n        parent.removeChild(jsonpScript);\r\n        try {\r\n            delete window[callbackFn];\r\n        } catch (error) {\r\n            window[callbackFn] = undefined;\r\n        }\r\n    };\r\n\r\n    window[callbackFn] = (response): void => {\r\n        cleanup();\r\n        onComplete(response);\r\n    };\r\n\r\n    jsonpScript.src =\r\n        url + (url.includes('?') ? '&' : '?') + 'callback=' + callbackFn;\r\n    jsonpScript.onerror = (): void => {\r\n        cleanup();\r\n        onError('error');\r\n    };\r\n\r\n    parent.append(jsonpScript);\r\n\r\n    timeoutId = setTimeout(() => {\r\n        cleanup();\r\n        window[callbackFn] = noop;\r\n        onError('timeout');\r\n    }, timeout);\r\n}\r\n\r\nexport default class Connection {\r\n    private clientId: string;\r\n    private host: string;\r\n    private servletUrl: string;\r\n    private queue: QEntry[] = [];\r\n    private counter = 1;\r\n    private socket: WebSocket;\r\n    private commandsHandler: (r: Response) => void;\r\n    private noopActive = false;\r\n    private processedCommands: string[] = [];\r\n    private ackCommands: string[] = [];\r\n    private lastNoop = 0;\r\n    private useWS: boolean;\r\n    private instanceId: string;\r\n    private closing = false;\r\n\r\n    constructor(\r\n        clientId: string,\r\n        host: string,\r\n        servletUrl: string,\r\n        forceLongPooling: boolean\r\n    ) {\r\n        this.clientId = clientId;\r\n        this.host = host;\r\n        this.servletUrl = servletUrl;\r\n        this.instanceId = Math.ceil(Math.random() * 0x1000000).toString(16);\r\n        while (this.instanceId.length < 6) {\r\n            this.instanceId = '0' + this.instanceId;\r\n        }\r\n\r\n        this.useWS = supportsWebSockets && !forceLongPooling;\r\n        if (this.useWS) {\r\n            this.openSocket();\r\n        }\r\n    }\r\n\r\n    public send(\r\n        action: string,\r\n        params: any,\r\n        callback: (response: Response) => any\r\n    ): void {\r\n        params.clientID = this.clientId;\r\n        params._uniq = this.counter++;\r\n        params._iid = this.instanceId;\r\n\r\n        logger.log('Connection.send', action, '_uniq', params._uniq);\r\n\r\n        const entry: QEntry = {\r\n            action: action,\r\n            params: params,\r\n            callback: callback,\r\n            queued: false,\r\n            timeoutId: 0\r\n            // format: 'json',\r\n            // strip: true,\r\n        };\r\n\r\n        if (this.useWS) {\r\n            this.queue.push(entry);\r\n            if (this.socket.readyState === WebSocket.OPEN) {\r\n                this.sendOverSocket(entry);\r\n            } else {\r\n                entry.queued = true;\r\n            }\r\n        } else {\r\n            this.sendOverJsonp(entry);\r\n        }\r\n    }\r\n\r\n    public startNoop(noopCommandsHandler: (r: Response) => void): void {\r\n        this.noopActive = true;\r\n        this.commandsHandler = noopCommandsHandler;\r\n        this.sendNoop('');\r\n    }\r\n\r\n    public close(): void {\r\n        this.closing = true;\r\n        this.noopActive = false;\r\n        this.queue.forEach((element) => {\r\n            if (element.timeoutId) {\r\n                window.clearTimeout(element.timeoutId);\r\n            }\r\n        });\r\n        // empty queue.\r\n        this.queue.splice(0, this.queue.length);\r\n        if (this.socket) {\r\n            this.socket.close();\r\n        }\r\n    }\r\n\r\n    private openSocket(): void {\r\n        const url = `wss://${this.host}/VXControl/`;\r\n        logger.log('Connection.openSocket', url);\r\n        let socket: WebSocket;\r\n        try {\r\n            socket = new WebSocket(url);\r\n        } catch (error) {\r\n            // @MDN SECURITY_ERR The port to which the connection is being attempted is being blocked.\r\n            logger.warn('Connection.openSocket SECURITY_ERR', error);\r\n            this.useWS = false;\r\n            return;\r\n        }\r\n\r\n        socket.onopen = (event): void => {\r\n            logger.log('Connection:socket.onopen', event);\r\n\r\n            this.queue.forEach((entry) => {\r\n                if (entry.queued) {\r\n                    entry.queued = false;\r\n                    this.sendOverSocket(entry);\r\n                }\r\n            });\r\n        };\r\n\r\n        socket.onmessage = (event): void => {\r\n            logger.log('Connection:socket.onmessage', event);\r\n\r\n            const data = JSON.parse(event.data);\r\n            if (data.action) {\r\n                const cmdId = data.params ? data.params._uniq : -1;\r\n                for (let i = 0, l = this.queue.length; i < l; i++) {\r\n                    const entry = this.queue[i];\r\n                    if (entry.params._uniq == cmdId) {\r\n                        clearTimeout(entry.timeoutId);\r\n                        this.queue.splice(i, 1);\r\n                        entry.callback(Response.parse(data.response));\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                const response = Response.parse(data.command);\r\n                this.noopResponseHandler(response);\r\n            }\r\n        };\r\n\r\n        socket.onerror = (errorEvent): void => {\r\n            logger.warn('Connection:socket.onerror', errorEvent);\r\n            this.fallback();\r\n        };\r\n\r\n        socket.onclose = (event): void => {\r\n            logger.log('Connection:socket.onclose', event);\r\n            if (!this.closing && this.useWS) {\r\n                this.fallback();\r\n            }\r\n        };\r\n        this.socket = socket;\r\n    }\r\n\r\n    private fallback(): void {\r\n        this.useWS = false;\r\n        this.queue.forEach((entry) => {\r\n            if (entry.queued) {\r\n                entry.queued = false;\r\n                this.sendOverJsonp(entry);\r\n            }\r\n        });\r\n    }\r\n\r\n    private sendNoop(commandIds: string): void {\r\n        if (this.lastNoop === 0) {\r\n            this.lastNoop = Date.now();\r\n        }\r\n        const params = { commandIDs: commandIds };\r\n        this.send('CMDP_NOOP', params, this.noopResponseHandler.bind(this));\r\n    }\r\n\r\n    private noopResponseHandler(response: Response): void {\r\n        if (!response.ok || response.commands.length > 0) {\r\n            logger.log('noopResponseHandler', response);\r\n        }\r\n\r\n        if (response.ok) {\r\n            this.lastNoop = 0;\r\n            this.ackCommands = [];\r\n            for (let i = response.commands.length - 1; i >= 0; i--) {\r\n                const cmdId: string = response.commands[i].id;\r\n                this.ackCommands.push(cmdId);\r\n                // prevents that commands are being processed multiple times\r\n                if (this.processedCommands.includes(cmdId)) {\r\n                    logger.warn('remove processed command', cmdId);\r\n                    response.commands.splice(i, 1);\r\n                } else {\r\n                    this.processedCommands.push(cmdId);\r\n                }\r\n            }\r\n            while (this.processedCommands.length > 50) {\r\n                this.processedCommands.shift();\r\n            }\r\n        }\r\n\r\n        if (\r\n            (response.commands.length > 0 || !response.ok) &&\r\n            (response !== Response.TIMEOUT ||\r\n                Date.now() - this.lastNoop > MAX_TIMEOUT)\r\n        ) {\r\n            this.commandsHandler(response);\r\n        }\r\n\r\n        if (this.noopActive) {\r\n            this.sendNoop(this.ackCommands.toString());\r\n        }\r\n    }\r\n\r\n    private sendOverSocket(entry: QEntry): void {\r\n        entry.timeoutId = window.setTimeout(() => {\r\n            window.clearTimeout(entry.timeoutId);\r\n            const index = this.queue.indexOf(entry);\r\n            if (index >= 0) {\r\n                this.queue.splice(index, 1);\r\n            }\r\n            if (this.noopActive || entry.action !== 'CMDP_NOOP') {\r\n                entry.callback(Response.TIMEOUT);\r\n            }\r\n        }, timeoutByAction(entry));\r\n        this.socket.send(\r\n            JSON.stringify({ action: entry.action, params: entry.params })\r\n        );\r\n    }\r\n\r\n    private sendOverJsonp(entry: QEntry): void {\r\n        let url = `${this.servletUrl}?action=${entry.action}`;\r\n        for (const key in entry.params) {\r\n            if (Object.prototype.hasOwnProperty.call(entry.params, key)) {\r\n                url +=\r\n                    '&' +\r\n                    encodeURIComponent(key) +\r\n                    '=' +\r\n                    encodeURIComponent(entry.params[key]);\r\n            }\r\n        }\r\n\r\n        fetchJsonp(\r\n            url,\r\n            timeoutByAction(entry),\r\n            (response: string) => {\r\n                entry.callback(Response.parse(response));\r\n            },\r\n            (error: string) => {\r\n                logger.warn('sendOverJsonp error', error, url);\r\n                if (error == 'timeout') {\r\n                    entry.callback(Response.TIMEOUT);\r\n                } else {\r\n                    entry.callback(Response.NETWORK_ERROR);\r\n                }\r\n            }\r\n        );\r\n    }\r\n}\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE__82__;","import { ChatHandler, Query } from './definitions';\r\nimport { ExitCode } from './exit-code';\r\nimport { SourceSet } from './sources/source-set';\r\n\r\nexport class Handler implements ChatHandler {\r\n    private et: EventTarget;\r\n    constructor(et: EventTarget) {\r\n        this.et = et;\r\n    }\r\n    public onChatStop(exitCode: ExitCode, exitMessage?: string): void {\r\n        this.dispatch('chatStop', { exitCode, exitMessage });\r\n    }\r\n    public onChatPause: () => void;\r\n    public onChatPauseHandler(): void {\r\n        this.dispatch('chatPause', {});\r\n    }\r\n    public onChatResume(sourceSet: SourceSet): void {\r\n        this.dispatch('chatResume', { sourceSet });\r\n    }\r\n    public onMessage(\r\n        text: string,\r\n        from: string,\r\n        key: string,\r\n        params: object\r\n    ): void {\r\n        this.dispatch('message', { text, from, key, params });\r\n    }\r\n    public onAbilityUpdate(name: string, value: boolean): void {\r\n        this.dispatch('abilityUpdate', { name, value });\r\n    }\r\n    public onQuery(query: Query): void {\r\n        this.dispatch('query', { query });\r\n    }\r\n    public onSingleModeUpdate(value: boolean): void {\r\n        this.dispatch('singleModeUpdate', { name: 'singleMode', value });\r\n    }\r\n    public onTextMuteUpdate(value: boolean): void {\r\n        this.dispatch('textMuteUpdate', { name: 'textMute', value });\r\n    }\r\n    public onAudioMuteUpdate(value: boolean): void {\r\n        this.dispatch('audioMuteUpdate', { name: 'audioMute', value });\r\n    }\r\n    public onLimitUpdate(param: string, value: number): void {\r\n        this.dispatch('limitUpdate', { param, value });\r\n    }\r\n    private dispatch(t: string, values: any): void {\r\n        const event = new Event(t);\r\n        for (const key in values) {\r\n            if (Object.prototype.hasOwnProperty.call(values, key)) {\r\n                event[key] = values[key];\r\n            }\r\n        }\r\n        this.et.dispatchEvent(event);\r\n    }\r\n}\r\n","/*\r\n * Copyright (c) 2016-2018. campoint AG.\r\n * This file is licensed under the MIT License (https://opensource.org/licenses/MIT).\r\n */\r\n\r\nimport { StartStreamConfig } from '../definitions';\r\nimport { SourceSet } from './source-set';\r\n\r\nconst defProtocols = ['jpeg', 'hls', 'rtmp', 'mp3', 'vorbis', 'webrtc'];\r\n\r\nexport function getSourceSet(\r\n    vv: any,\r\n    av: any,\r\n    config: StartStreamConfig,\r\n    protocols: string[] = defProtocols\r\n): SourceSet {\r\n    const videoDataUrl: string = vv.dataURL;\r\n    const audioDataUrl: string = av.dataURL;\r\n\r\n    const isMobile = config.mobile;\r\n\r\n    const sourceSet: SourceSet = {};\r\n\r\n    if (protocols.includes('jpeg') || protocols.includes('mjpeg')) {\r\n        getJpegSources(\r\n            config,\r\n            protocols,\r\n            vv,\r\n            isMobile,\r\n            sourceSet,\r\n            videoDataUrl\r\n        );\r\n    }\r\n    if (protocols.includes('hls')) {\r\n        getHlsSource(isMobile, vv, sourceSet);\r\n    }\r\n    if (protocols.includes('rtmp')) {\r\n        getRtmpSource(sourceSet, vv);\r\n    }\r\n    if (protocols.includes('webrtc')) {\r\n        getWebRtcSource(sourceSet, vv);\r\n    }\r\n\r\n    if (vv.hlsURL && protocols.includes('hls')) {\r\n        sourceSet.hls.unshift({ stream: vv.hlsURL });\r\n        sourceSet.preferredOrder = ['hls', 'hds', 'rtmp', 'mjpeg', 'jpeg'];\r\n        if (!vv.hdsURL) {\r\n            sourceSet.preferredOrder.splice(1, 1);\r\n        }\r\n    }\r\n\r\n    if (av && audioDataUrl) {\r\n        getAudioSources(protocols, sourceSet, audioDataUrl);\r\n    }\r\n\r\n    return sourceSet;\r\n}\r\n\r\nfunction getAudioSources(\r\n    protocols: string[],\r\n    sourceSet: SourceSet,\r\n    aDataUrl: string\r\n): void {\r\n    if (protocols.includes('mp3')) {\r\n        getMp3Source(sourceSet, aDataUrl);\r\n    }\r\n    if (protocols.includes('vorbis')) {\r\n        getVorbisSource(sourceSet, aDataUrl);\r\n    }\r\n}\r\n\r\nfunction getWebRtcSource(sourceSet: SourceSet, vv: any): void {\r\n    if (vv.mediaWebrtcUrl) {\r\n        sourceSet.webrtc = [\r\n            {\r\n                stream: vv.mediaWebrtcUrl\r\n            }\r\n        ];\r\n    }\r\n}\r\n\r\nfunction getVorbisSource(sourceSet: SourceSet, aDataUrl: string): void {\r\n    sourceSet.vorbis = [\r\n        {\r\n            stream: aDataUrl + '&format=13&f=stream.ogg'\r\n        }\r\n    ];\r\n}\r\n\r\nfunction getMp3Source(sourceSet: SourceSet, aDataUrl: string): void {\r\n    sourceSet.mp3 = [\r\n        {\r\n            stream: aDataUrl + '&format=8&f=stream.mp3'\r\n        }\r\n    ];\r\n}\r\n\r\nfunction getJpegSources(\r\n    config: StartStreamConfig,\r\n    protocols: string[],\r\n    vv: any,\r\n    isMobile: boolean,\r\n    sourceSet: SourceSet,\r\n    vDataUrl: string\r\n): void {\r\n    const maxFps = config.maxFps > 0 ? config.maxFps : 15;\r\n    let params = '';\r\n    if (config.width) {\r\n        params += `&width=${config.width}`;\r\n    }\r\n    if (config.height) {\r\n        params += `&height=${config.height}`;\r\n    }\r\n    if (config.resizeMode) {\r\n        params += `&sizemode=${config.resizeMode}`;\r\n    }\r\n    if (protocols.includes('jpeg')) {\r\n        getJpegSource(vv, isMobile, params, sourceSet);\r\n    }\r\n    if (protocols.includes('mjpeg')) {\r\n        getMJpegSource(sourceSet, vDataUrl, isMobile, maxFps, params);\r\n    }\r\n}\r\n\r\nfunction getRtmpSource(sourceSet: SourceSet, vv: any): void {\r\n    if (vv.mediaRtmpUrl) {\r\n        const rtmpUrl = vv.mediaRtmpUrl;\r\n        const rtmpUrlPattern = /(.*)\\/(\\d+)/;\r\n\r\n        const rtmp = rtmpUrlPattern.exec(rtmpUrl);\r\n\r\n        if (rtmp) {\r\n            sourceSet.rtmp = [\r\n                {\r\n                    app: rtmp[1],\r\n                    stream: rtmp[2]\r\n                }\r\n            ];\r\n        }\r\n    }\r\n}\r\n\r\nfunction getHlsSource(isMobile: boolean, vv: any, sourceSet: SourceSet): void {\r\n    let hlsStreamUrl: string;\r\n    if (isMobile) {\r\n        hlsStreamUrl = vv.mediaHlsMobileUrl;\r\n    } else {\r\n        hlsStreamUrl = vv.mediaHlsUrl;\r\n    }\r\n\r\n    if (hlsStreamUrl) {\r\n        sourceSet.hls = [\r\n            {\r\n                stream: hlsStreamUrl\r\n            }\r\n        ];\r\n    }\r\n}\r\n\r\nfunction getMJpegSource(\r\n    sourceSet: SourceSet,\r\n    vDataUrl: string,\r\n    isMobile: boolean,\r\n    maxFps: number,\r\n    params: string\r\n): void {\r\n    sourceSet.mjpeg = [\r\n        {\r\n            stream:\r\n                vDataUrl +\r\n                (isMobile ? '&format=42' : '&format=20&quality=80') +\r\n                `&fps=${maxFps}${params}`\r\n        }\r\n    ];\r\n}\r\n\r\nfunction getJpegSource(\r\n    vv: any,\r\n    isMobile: boolean,\r\n    params: string,\r\n    sourceSet: SourceSet\r\n): void {\r\n    if (vv.mediaJpegUrl) {\r\n        const jpegSource =\r\n            vv.mediaJpegUrl +\r\n            (isMobile ? '&format=43' : '&format=15&quality=80') +\r\n            params;\r\n        sourceSet.jpeg = [\r\n            {\r\n                stream: jpegSource\r\n            }\r\n        ];\r\n    }\r\n}\r\n","import { LogEntry } from './log-entry';\r\nimport { Logger } from './logger';\r\n\r\nexport class LogCollector implements Logger {\r\n    public static readonly LOG = 10;\r\n    public static readonly WARN = 20;\r\n    public static readonly ERROR = 30;\r\n    private logEntries: LogEntry[] = [];\r\n    private logger: Logger;\r\n    constructor(l?: Logger) {\r\n        this.logger = l;\r\n    }\r\n\r\n    public clear(): void {\r\n        this.logEntries = [];\r\n    }\r\n\r\n    get logs(): LogEntry[] {\r\n        return this.logEntries;\r\n    }\r\n\r\n    public log(message?: any, ...params: any[]): void {\r\n        this.push(LogCollector.LOG, message, params);\r\n    }\r\n\r\n    public warn(message?: any, ...params: any[]): void {\r\n        this.push(LogCollector.WARN, message, params);\r\n    }\r\n\r\n    public error(message?: any, ...params: any[]): void {\r\n        this.push(LogCollector.ERROR, message, params);\r\n    }\r\n\r\n    public exportToStr(minLevel = 0, entries = 0): string {\r\n        let out = '';\r\n        const len = this.logEntries.length;\r\n        for (\r\n            let i = entries === 0 ? 0 : Math.max(len - entries, 0);\r\n            i < len;\r\n            i++\r\n        ) {\r\n            const entry = this.logEntries[i];\r\n            if (entry.level < minLevel) {\r\n                continue;\r\n            }\r\n\r\n            const level = LogCollector.getLogLevelAsString(entry.level);\r\n            const date = LogCollector.GetLogEventDateAsString(\r\n                new Date(entry.time)\r\n            );\r\n\r\n            out +=\r\n                date +\r\n                ' ' +\r\n                level +\r\n                ' ' +\r\n                entry.message +\r\n                (entry.params ? ' ' + JSON.stringify(entry.params) : '') +\r\n                '\\n';\r\n        }\r\n        return out;\r\n    }\r\n\r\n    private static GetLogEventDateAsString(d: Date): string {\r\n        return d.toTimeString();\r\n    }\r\n\r\n    private static getLogLevelAsString(level: number): string {\r\n        if (level >= LogCollector.ERROR) {\r\n            return 'ERROR';\r\n        } else if (level >= LogCollector.WARN) {\r\n            return 'WARN';\r\n        } else {\r\n            return 'INFO';\r\n        }\r\n    }\r\n\r\n    private static getLogMethodByLevel(\r\n        logger: Logger,\r\n        level: number\r\n    ): (message?: any, ...params: any[]) => void {\r\n        if (level >= LogCollector.ERROR) {\r\n            return logger.error;\r\n        } else if (level >= LogCollector.WARN) {\r\n            return logger.warn;\r\n        } else {\r\n            return logger.log;\r\n        }\r\n    }\r\n\r\n    private push(level: number, message: any, params: any[]): void {\r\n        this.logEntries.push({ level, time: Date.now(), message, params });\r\n        if (this.logger) {\r\n            const method = LogCollector.getLogMethodByLevel(this.logger, level);\r\n            if (params) {\r\n                const p = [message].concat(params);\r\n                try {\r\n                    // TODO edge-mobile doesn't like it\r\n                    method(...p);\r\n                } catch (error) {\r\n                    //\r\n                }\r\n            } else {\r\n                method(message);\r\n            }\r\n        }\r\n    }\r\n}\r\n","/*\r\n * Copyright (c) 2016-2018. campoint AG.\r\n * This file is licensed under the MIT License (https://opensource.org/licenses/MIT).\r\n */\r\n\r\nimport { supportsFileReader, supportsWebSockets } from './capabilities';\r\nimport { logger } from './logging/logger';\r\n\r\nconst POOL_SIZE = 5;\r\nconst DATA_HEAD = 'data:image/jpeg;';\r\n\r\ninterface Loader {\r\n    id: number;\r\n    img: HTMLImageElement;\r\n    frame: number;\r\n    ready: boolean;\r\n}\r\n\r\nexport class PicStream {\r\n    private counter = 0;\r\n    private lastFrame = 0;\r\n\r\n    private source = '';\r\n\r\n    private pool: Loader[] = [];\r\n    private timer = 0;\r\n\r\n    private handler: (imageElement: HTMLImageElement) => void;\r\n    private target: { src: string };\r\n\r\n    private socket: WebSocket;\r\n    private fileReader: FileReader;\r\n    private fallbackTimer: number;\r\n\r\n    private useWS = true;\r\n    private maxFps: number;\r\n\r\n    constructor(\r\n        target: { src: string } | ((imageElement: HTMLImageElement) => void)\r\n    ) {\r\n        if (typeof target === 'function') {\r\n            this.handler = target;\r\n        } else {\r\n            this.target = target;\r\n        }\r\n\r\n        if (supportsFileReader) {\r\n            this.fileReader = new FileReader();\r\n            this.fileReader.onload = (event): void => {\r\n                let data: string = (event.target as any).result;\r\n                if (!data.startsWith(DATA_HEAD)) {\r\n                    data =\r\n                        DATA_HEAD +\r\n                        data.slice(Math.max(0, data.indexOf('base64,')));\r\n                }\r\n                this.loadFrame(data);\r\n            };\r\n        }\r\n\r\n        for (let i = 0; i < POOL_SIZE; i++) {\r\n            this.pool.push(this.createLoader(i));\r\n        }\r\n    }\r\n\r\n    public play(source: string, fps?: number): void {\r\n        this.stop();\r\n        if (!fps || fps < 0) {\r\n            const res = /fps=(\\d+)/.exec(source);\r\n            fps = res ? parseInt(res[1], 10) : 15;\r\n        }\r\n        this.maxFps = fps;\r\n        this.source = source;\r\n\r\n        if (supportsWebSockets && this.useWS) {\r\n            this._playWS();\r\n        } else {\r\n            this._play();\r\n        }\r\n    }\r\n\r\n    public stop(): void {\r\n        if (this.timer) {\r\n            clearInterval(this.timer);\r\n        }\r\n        if (this.fallbackTimer) {\r\n            clearTimeout(this.fallbackTimer);\r\n        }\r\n        this.timer = this.fallbackTimer = 0;\r\n\r\n        if (this.socket) {\r\n            this.socket.close();\r\n        }\r\n\r\n        for (let i = 0; i < POOL_SIZE; i++) {\r\n            this.pool[i].img.src = '';\r\n        }\r\n    }\r\n\r\n    private _playWS(): void {\r\n        const wsSource = this.source\r\n            .replace(/https?:/, 'wss:')\r\n            .replace(/:\\d+\\//, ':443/');\r\n        let socket: WebSocket;\r\n        try {\r\n            socket = new WebSocket(wsSource);\r\n        } catch (error) {\r\n            // @MDN SECURITY_ERR The port to which the connection is being attempted is being blocked.\r\n            logger.warn('PicStream._playWS SECURITY_ERR', error);\r\n            this.useWS = false;\r\n            this._play();\r\n            return;\r\n        }\r\n        socket.onopen = (): void => {\r\n            socket.send(\r\n                JSON.stringify({\r\n                    action: 'CMDS_STARTVIDEOPULL',\r\n                    params: {\r\n                        fps: this.maxFps,\r\n                        base64: !this.fileReader\r\n                    }\r\n                })\r\n            );\r\n        };\r\n        socket.onmessage = (ev): void => {\r\n            clearTimeout(this.fallbackTimer);\r\n            socket.onmessage = (event): void => {\r\n                const data = event.data;\r\n                if (typeof data === 'string') {\r\n                    // base64 encoded jpeg image data handling\r\n                    this.loadFrame(DATA_HEAD + 'base64,' + data);\r\n                } else {\r\n                    const fr = this.fileReader;\r\n                    // drop a frame in case the fileReader is too slow\r\n                    if (fr && (fr.readyState === 2 || fr.readyState === 0)) {\r\n                        fr.readAsDataURL(data);\r\n                    }\r\n                }\r\n            };\r\n            socket.onmessage(ev);\r\n        };\r\n        socket.onerror = (event): void => {\r\n            logger.warn(event);\r\n            clearTimeout(this.fallbackTimer);\r\n            this.useWS = false;\r\n            this._play();\r\n        };\r\n        socket.onclose = (): void => {\r\n            logger.log('closed');\r\n            // TODO\r\n        };\r\n        this.fallbackTimer = window.setTimeout(() => {\r\n            logger.warn('PicStream._playWS fallbackTimer');\r\n            this.useWS = false;\r\n            socket.close(); // TODO code & reason https://developer.mozilla.org/en-US/docs/Web/API/WebSocket#close()\r\n            this._play();\r\n        }, 8000);\r\n        this.socket = socket;\r\n    }\r\n\r\n    private _play(): void {\r\n        // TODO 'Dynamically adjusts the framerate by calculating how many frames were properly received in the last check interval'\r\n        if (!this.timer) {\r\n            this.timer = window.setInterval(\r\n                this.loadFrame.bind(this),\r\n                1000 / this.maxFps\r\n            );\r\n            this.loadFrame();\r\n        }\r\n    }\r\n\r\n    private createLoader(id: number): Loader {\r\n        const loader: Loader = { id: id, img: null, frame: 0, ready: true };\r\n        const img = document.createElement('img');\r\n        img.onload = (): void => {\r\n            if (loader.frame > this.lastFrame) {\r\n                this.lastFrame = loader.frame;\r\n                if (this.target) {\r\n                    this.target.src = img.src;\r\n                } else {\r\n                    this.handler(img);\r\n                }\r\n            }\r\n            loader.ready = true;\r\n        };\r\n        img.onerror = (): void => {\r\n            loader.ready = true;\r\n        };\r\n        loader.img = img;\r\n        return loader;\r\n    }\r\n\r\n    private loadFrame(source?: string): void {\r\n        for (let i = 0; i < POOL_SIZE; i++) {\r\n            const entry = this.pool[i];\r\n            if (entry.ready || entry.frame <= this.lastFrame) {\r\n                entry.frame = ++this.counter;\r\n                entry.ready = false;\r\n                entry.img.src = source\r\n                    ? source\r\n                    : `${this.source}&_u=${entry.frame}`;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n","/*\r\n * Copyright (c) 2016-2018. campoint AG.\r\n * This file is licensed under the MIT License (https://opensource.org/licenses/MIT).\r\n */\r\n\r\nimport { supportsWebSockets } from './capabilities';\r\nimport { logger } from './logging/logger';\r\nimport { Provider } from './provider';\r\n\r\nfunction dataUrlToBlob(dataUrl: string): Blob {\r\n    let raw: BlobPart;\r\n    let contentType: string;\r\n\r\n    if (!dataUrl.includes(';base64,')) {\r\n        const parts = dataUrl.split(',');\r\n        contentType = parts[0].split(':')[1];\r\n        raw = parts[1];\r\n    } else {\r\n        const parts = dataUrl.split(';base64,');\r\n        contentType = parts[0].split(':')[1];\r\n        const decoded = window.atob(parts[1]);\r\n        const rawLength = decoded.length;\r\n        raw = new Uint8Array(rawLength);\r\n        for (let i = 0; i < rawLength; ++i) {\r\n            raw[i] = decoded.charCodeAt(i);\r\n        }\r\n    }\r\n\r\n    return new Blob([raw], { type: contentType });\r\n}\r\n\r\nexport class PicUpStream {\r\n    private _maxFps: number;\r\n    private _target: string;\r\n\r\n    private _provider: Provider;\r\n    private _socket: WebSocket;\r\n\r\n    private _publishLoop: number;\r\n    private _publishStopRequested = false;\r\n\r\n    constructor(provider: Provider) {\r\n        this._provider = provider;\r\n    }\r\n\r\n    public publish(target: string, targetFps = 1): void {\r\n        this._maxFps = Math.max(1, targetFps);\r\n        this._target = target;\r\n\r\n        if (supportsWebSockets) {\r\n            this._publishWS();\r\n        }\r\n    }\r\n\r\n    public stop(): void {\r\n        this._stopPublishLoop();\r\n\r\n        if (this._socket) {\r\n            this._socket.close();\r\n            this._socket = null;\r\n        }\r\n    }\r\n\r\n    private _stopPublishLoop(): void {\r\n        if (this._publishLoop !== 0) {\r\n            this._publishStopRequested = true;\r\n            clearTimeout(this._publishLoop);\r\n            this._publishLoop = 0;\r\n        }\r\n    }\r\n\r\n    private _publishWS(): void {\r\n        const wsSource = this._target\r\n            .replace(/https?:/, 'wss:')\r\n            .replace(/:\\d+\\//, ':443/');\r\n        const socket = new WebSocket(wsSource);\r\n        socket.onopen = (): void => {\r\n            const command = `{\"action\":\"CMDS_STARTVIDEOPUSH\",\"params\":{\"fps\":${this._maxFps},\"base64\":true}}`;\r\n            socket.send(command);\r\n            this._startPublishLoop();\r\n        };\r\n        socket.onmessage = (): void => {\r\n            // ignore\r\n        };\r\n        socket.onerror = (event): void => {\r\n            logger.warn(event);\r\n            this.stop();\r\n            // TODO\r\n        };\r\n        socket.onclose = (event): void => {\r\n            logger.log('PicUpStream.socket.onclose', event);\r\n            this._stopPublishLoop();\r\n        };\r\n        this._socket = socket;\r\n    }\r\n\r\n    private _startPublishLoop(): void {\r\n        this._publishStopRequested = false;\r\n\r\n        this._publishLoopCall();\r\n    }\r\n\r\n    private async _publishLoopCall(): Promise<void> {\r\n        const snapshot = await this._provider.getSnapshot();\r\n        if (snapshot) {\r\n            this._send(snapshot);\r\n        }\r\n\r\n        if (!this._publishStopRequested) {\r\n            this._publishLoop = window.setTimeout(\r\n                this._publishLoopCall.bind(this),\r\n                1000 / this._maxFps\r\n            );\r\n        }\r\n    }\r\n\r\n    private _send(snapshot: string | ArrayBuffer | Blob): void {\r\n        if (this._socket.OPEN && this._socket.bufferedAmount < 32768) {\r\n            if (typeof snapshot === 'string') {\r\n                this._socket.send(dataUrlToBlob(snapshot));\r\n            } else {\r\n                this._socket.send(snapshot);\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":""}